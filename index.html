<!DOCTYPE html>
<html><head><meta charset="utf-8">
<meta name="description" content="Effective D Programming Language.">
<style type="text/css"  media="all" >/* Eric Meyer's Reset CSS v2.0 - http://cssreset.com */
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{border:0;font-size:100%;font:inherit;vertical-align:baseline;margin:0;padding:0}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:none}table{border-collapse:collapse;border-spacing:0}
html
{
    height: 100%;
    font-size: 10px;
}

body
{
    font-family: "HelveticaNeue", "Helvetica Neue", "HelveticaNeueRoman", "HelveticaNeue-Roman", "Helvetica Neue Roman", 'TeXGyreHerosRegular', "Helvetica", "Tahoma", "Geneva", "Arial", sans-serif;
    font-weight: 400;
    font-stretch: normal;
    display: block;
    color: #bbbbbb;
    background-color: #424040;
}

.sub
{
    font-size: 0.8em;
    vertical-align: super;
}

.container
{
    display: block;
    width: 90%;
    max-width: 1100px;
    padding: 0.5rem;
    margin: 0 auto;
    background-color: #bbbbbc;
    box-shadow: 0.2rem 0.4rem 1rem 0rem rgba(32,32,32,0.15);
}

.permalink
{
    float: right;
    display: inline-block;
    font-size: 0.7em;
}

header
{
    display: block;
    width: 90%;
    max-width: 1100px;
    padding: 0 0.5rem;
    margin: 0 auto;
    background-color: #744;
    font-weight: 700;
    vertical-align: middle;
    box-shadow: 0.2em 0.8em 1em 0em rgba(32,32,32,0.15);
    z-index: 5;
    color: #e8e8ef;
}
nav
{
    display: block;
    width: 90%;
    max-width: 1100px;
    font-size: 1.6rem;
    padding: 0.5rem;
    margin: 0 auto;
    background-color: #ededef;
    list-style-type: square;
    box-shadow: 0.2em 0.4em 2.0em 0em rgba(32,32,32,0.1);
    z-index: 10;
}

footer
{
    display: block;
    width: 90%;
    max-width: 1100px;
    font-size: 1.6rem;
    padding: 0.5rem;
    margin: 0 auto;
    background-color: #744;
    list-style-type: square;
    box-shadow: 0.2em 0.4em 2.0em 0em rgba(32,32,32,0.1);
    z-index: 10;
    color: black;
    line-height: 1.3em;
}


footer h2
{
    color: #f8deb7;
    padding: 4rem 4.25rem 0rem 4.25rem;
    margin: 2rem;
}

footer p, footer ul
{
    padding: 0rem 4.25rem 0rem 4.25rem;
    margin: 2rem;
    color: #ccb3b3;
}

footer a
{
    color: #84c6ea;
}

a
{
    text-decoration: none;
    color: #5050c0;
    font-weight: 700;
}

a:hover
{
    color: #5000c0;
    text-decoration: underline;
}

.item-nav
{
    padding: 0.32em;
    margin: 1rem 8rem 1rem 8rem;
    display: list-item;
}

h1
{
    font-size: 2.38rem;
    padding: 1.2rem;
    margin: 0em 0em 2.4rem 1.2rem;
    color: #444;
}

h2
{
    font-size: 1.9rem;
    padding: 0.34rem;
    margin: 4rem 0rem 1rem -0.5rem;
    color: #444;
}

p
{
    padding: 1rem 2rem;
    padding: 1rem 2rem;
    max-width: 80rem;
}

ol
{
    margin: 0.85rem;
}

li
{
    display: list-item;
    list-style: square;
    margin: 0rem 0rem 0rem 6rem;
    padding: 0.34rem;
}

strong
{
    font-weight: 700;
}

em
{
    font-style:italic;
}

.prettyprint
{
    font-family: "Inconsolata", "Courier New", "Courier", monospace, sans-serif;
    color: #883900;
}

pre
{
    font-family: "Inconsolata", "Courier New", "Courier", monospace, sans-serif;
    padding: 0rem;
    margin: 1.7rem;
    font-size: 1.53rem;
    line-height: 1.7rem;
    box-shadow: inset 0.15rem 0.3rem 1.5rem 0rem rgba(0,0,0,0.2);
}
.idiom
{
    font-size: 1.7rem;
    color: #222;
    background-color: #ededef;
    display: block;
    padding: 8rem 6rem;
    margin: 2.4rem;
    line-height: 2.5rem;
    box-shadow: 0.17rem 0.34rem 1.7rem 0rem rgba(32,32,32,0.15);
}

#logo
{
    position: relative;
    display: inline-block;
    left: -0.5rem;
    vertical-align: bottom;
}

#title-container
{
    display: inline-block;
    vertical-align: bottom;
    margin: 4.3rem 1rem 4.3rem 1rem;
}

#title
{
    font-size: 2.3rem;
    line-height: 1em;
}

#sub-title
{
    font-size: 0.5em;
    font-style: italic;
    font-weight: normal;
    color: #b37777;
}
/*
#contributors ul
{
    margin: 0rem 0rem 5rem 5rem;
    color: white;
}

#contributors li
{
    color: white;
}
*//*

vim-hybrid theme by w0ng (https://github.com/w0ng/vim-hybrid)

*/

/*background color*/
.hljs {
  display: block;
  overflow-x: auto;
  padding: 1.0em;
  background: #1d1f21;
  -webkit-text-size-adjust: none;
}

/*selection color*/
.hljs::selection,
.hljs span::selection {
	background: #bababa;
}
.hljs::-moz-selection,
.hljs span::-moz-selection {
	background: #bababa;
}

/*foreground color*/
.hljs,
.hljs-setting .hljs-value,
.hljs-expression .hljs-variable,
.hljs-expression .hljs-begin-block,
.hljs-expression .hljs-end-block,
.hljs-class .hljs-params,
.hljs-function .hljs-params,
.hljs-at_rule .hljs-preprocessor {
  color: #c5c8c6;
}

/*color: fg_yellow*/
.hljs-title,
.hljs-function .hljs-title,
.hljs-keyword .hljs-common,
.hljs-class .hljs-title,
.hljs-decorator,
.hljs-tag .hljs-title,
.hljs-header,
.hljs-sub,
.hljs-function {
  color: #f0c674;
}

/*color: fg_comment*/
.hljs-comment,
.hljs-javadoc,
.hljs-output .hljs-value,
.hljs-pi,
.hljs-shebang,
.hljs-doctype {
  color: #707880;
}

/*color: fg_red*/
.hljs-number,
.hljs-symbol,
.hljs-literal,
.hljs-deletion,
.hljs-link_url,
.hljs-symbol .hljs-string,
.hljs-argument,
.hljs-hexcolor,
.hljs-input .hljs-prompt,
.hljs-char {
 color: #cc6666
}

/*color: fg_green*/
.hljs-string,
.hljs-special,
.hljs-javadoctag,
.hljs-addition,
.hljs-important,
.hljs-tag .hljs-value,
.hljs-at.rule .hljs-keyword,
.hljs-regexp,
.hljs-attr_selector {
  color: #b5bd68;
}

/*color: fg_purple*/
.hljs-variable,
.hljs-property,
.hljs-envar,
.hljs-code,
.hljs-expression,
.hljs-localvars,
.hljs-id,
.hljs-variable .hljs-filter,
.hljs-variable .hljs-filter .hljs-keyword,
.hljs-template_tag .hljs-filter .hljs-keyword {
 color: #b294bb;
}

/*color: fg_blue*/
.hljs-statement,
.hljs-label,
.hljs-keyword,
.hljs-xmlDocTag,
.hljs-function .hljs-keyword,
.hljs-chunk,
.hljs-cdata,
.hljs-link_label,
.hljs-bullet,
.hljs-class .hljs-keyword,
.hljs-smartquote,
.hljs-method,
.hljs-list .hljs-title,
.hljs-tag {
 color: #81a2be;
}

/*color: fg_aqua*/
.hljs-pseudo,
.hljs-exception,
.hljs-annotation,
.hljs-subst,
.hljs-change,
.hljs-cbracket,
.hljs-operator,
.hljs-horizontal_rule,
.hljs-preprocessor .hljs-keyword,
.hljs-typedef,
.hljs-template_tag,
.hljs-variable,
.hljs-variable .hljs-filter .hljs-argument,
.hljs-at_rule,
.hljs-at_rule .hljs-string,
.hljs-at_rule .hljs-keyword {
  color: #8abeb7;
}


/*color: fg_orange*/
.hljs-type,
.hljs-typename,
.hljs-inheritance .hljs-parent,
.hljs-constant,
.hljs-built_in,
.hljs-setting,
.hljs-structure,
.hljs-link_reference,
.hljs-attribute,
.hljs-blockquote,
.hljs-quoted,
.hljs-class,
.hljs-header {
  color: #de935f;
}

.hljs-emphasis
{
  font-style: italic;
}

.hljs-strong
{
  font-weight: bold;
}




</style><link href='//fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
<title>d-idioms - Idioms for the D programming language</title></head><body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-71912218-1', 'auto');ga('send', 'pageview');</script><script src="highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<header><img id="logo" src="d-logo.svg"></img><div id="title-container"><div id="title">Idioms for the D Programming Language
<br><div id="sub-title"><b>ἰδῐόω</b> (idióō): peculiarity, specific property, unique feature.</div></div></div></header><nav><div class="item-nav"><a href="#DIID-#1---Parse-XML-file">DIID #1 - Parse XML file
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Dec 9<span class="sub">th</span> 2021
</span></div><div class="item-nav"><a href="#Renaming-a-module-with-backwards-compatibility">Renaming a module with backwards compatibility
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Sep 14<span class="sub">th</span> 2021
</span></div><div class="item-nav"><a href="#Emulating-Perl's-__DATA__">Emulating Perl's __DATA__
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Sep 14<span class="sub">th</span> 2021
</span></div><div class="item-nav"><a href="#GC-proof-resource-class">GC-proof resource class
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Oct 25<span class="sub">th</span> 2020, created Aug 30<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Don't-use-@property">Don't use @property
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created May 11<span class="sub">th</span> 2019
</span></div><div class="item-nav"><a href="#Phobos-gems">Phobos gems
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Mar 14<span class="sub">th</span> 2019, created Jan 17<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Parallel-foreach">Parallel foreach
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Mar 3<span class="sub">rd</span> 2019
</span></div><div class="item-nav"><a href="#Unittests-with-optimizations-&#x3A-the-Final-Frontier">Unittests with optimizations &#x3A the Final Frontier
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Mar 3<span class="sub">rd</span> 2019
</span></div><div class="item-nav"><a href="#One-does-not-simply-call-new-for-static-arrays">One does not simply call new for static arrays
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Feb 24<span class="sub">th</span> 2019, created May 6<span class="sub">th</span> 2018
</span></div><div class="item-nav"><a href="#Contributing-back-with-money">Contributing back with money
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Feb 3<span class="sub">rd</span> 2019, created Mar 1<span class="sub">st</span> 2018
</span></div><div class="item-nav"><a href="#Working-with-files">Working with files
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Sep 25<span class="sub">th</span> 2018, created Oct 4<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Voldemort-types">Voldemort types
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Sep 16<span class="sub">th</span> 2018, created Jan 5<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Type-qualifiers-and-slices-creation">Type qualifiers and slices creation
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created May 6<span class="sub">th</span> 2018
</span></div><div class="item-nav"><a href="#Static-arrays-are-value-types">Static arrays are value types
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified May 6<span class="sub">th</span> 2018, created Jan 10<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#So-what-does--debug-do,-exactly&#63;">So what does -debug do, exactly&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Apr 18<span class="sub">th</span> 2018
</span></div><div class="item-nav"><a href="#Differences-in-integer-handling-vs-C">Differences in integer handling vs C
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Feb 9<span class="sub">th</span> 2018, created Feb 14<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Games-made-with-D">Games made with D
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Feb 9<span class="sub">th</span> 2018, created Sep 14<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Everything-you-wanted-to-ask-about-struct-construction">Everything you wanted to ask about struct construction
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Sep 24<span class="sub">th</span> 2017
</span></div><div class="item-nav"><a href="#Is-this-available-at-compile-time-or-runtime&#63;">Is this available at compile-time or runtime&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified May 4<span class="sub">th</span> 2017, created Apr 19<span class="sub">th</span> 2017
</span></div><div class="item-nav"><a href="#Slices-.capacity,-the-mysterious-property">Slices .capacity, the mysterious property
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Apr 18<span class="sub">th</span> 2017, created Mar 22<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Rvalue-references&#x3A;-Understanding-auto-ref-and-then-not-using-it">Rvalue references&#x3A; Understanding auto ref and then not using it
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Nov 21<span class="sub">th</span> 2016, created Oct 23<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#@nogc-Array-Literals&#x3A;-Breaking-the-Limits">@nogc Array Literals&#x3A; Breaking the Limits
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Oct 23<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Compile-time-RNG">Compile-time RNG
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Oct 19<span class="sub">th</span> 2016, created Feb 5<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Leveraging-TLS-for-a-fast-thread-safe-singleton">Leveraging TLS for a fast thread-safe singleton
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Oct 19<span class="sub">th</span> 2016, created Mar 20<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Smallest-valid-D-program">Smallest valid D program
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Oct 19<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#People-blogging-about-D">People blogging about D
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Sep 20<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#So-what-do-module-declarations-do,-exactly&#63;">So what do module declarations do, exactly&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Sep 4<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#So-D-is-just-C++-with-a-Garbage-Collector&#63;">So D is just C++ with a Garbage Collector&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Sep 4<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#The-trouble-with-class-destructors">The trouble with class destructors
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Sep 4<span class="sub">th</span> 2016, created Jan 31<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Which-book-should-I-read&#63;">Which book should I read&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Sep 4<span class="sub">th</span> 2016, created Jan 5<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Four-ways-to-use-the-static-keyword-you-may-not-know-about">Four ways to use the static keyword you may not know about
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Sep 4<span class="sub">th</span> 2016, created Jan 26<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Optimal-AA-lookup">Optimal AA lookup
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jun 4<span class="sub">th</span> 2016, created Jan 10<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Porting-from-C-gotchas">Porting from C gotchas
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jun 4<span class="sub">th</span> 2016, created Jan 11<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Precomputed-tables-at-compile-time-through-CTFE">Precomputed tables at compile-time through CTFE
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jun 4<span class="sub">th</span> 2016, created Jan 26<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Qualified-switch-using-with">Qualified switch using with
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jun 4<span class="sub">th</span> 2016, created Jan 4<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#The-importance-of-being-pure">The importance of being pure
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jun 4<span class="sub">th</span> 2016, created Jan 27<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#The-impossible-real-time-thread">The impossible real-time thread
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jun 4<span class="sub">th</span> 2016, created Jan 24<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Eponymous-templates">Eponymous templates
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified May 25<span class="sub">th</span> 2016, created Oct 4<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Enumerate-fields-with-__traits(allMembers)-and-static-foreach">Enumerate fields with __traits(allMembers) and static foreach
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Mar 20<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Automatic-attribute-inference-for-function-templates">Automatic attribute inference for function templates
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Feb 14<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Converting-from-and-to-C-strings">Converting from and to C strings
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Feb 14<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Trailing-commas">Trailing commas
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 27<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#So-what-does--release-do,-exactly&#63;">So what does -release do, exactly&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 27<span class="sub">th</span> 2016, created May 16<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Getting-a-method-callbacked-from-C">Getting a method callbacked from C
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 27<span class="sub">th</span> 2016, created Jan 23<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Design-by-Introspection">Design by Introspection
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 23<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Using-std.typecons.Flag-like-a-pro">Using std.typecons.Flag like a pro
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 21<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#String-interpolation-as-a-library">String interpolation as a library
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 20<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#assert(false)-is-special">assert(false) is special
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 20<span class="sub">th</span> 2016, created Jan 14<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Is-a-specific-program-available-in-PATH&#63;">Is a specific program available in PATH&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 5<span class="sub">th</span> 2016, created Oct 15<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Knowing-inout-inside-out">Knowing inout inside out
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 5<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#Never-use-&gt;=-for-dependencies">Never use &gt;= for dependencies
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 4<span class="sub">th</span> 2016, created Jan 28<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Throwing-despite-@nogc">Throwing despite @nogc
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 4<span class="sub">th</span> 2016, created Jun 8<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#What-is-the-difference-between-out-and-ref-parameters&#x3F">What is the difference between out and ref parameters&#x3F
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 4<span class="sub">th</span> 2016
</span></div><div class="item-nav"><a href="#How-does-D-improve-on-C++17&#63;">How does D improve on C++17&#63;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 2<span class="sub">nd</span> 2016, created Apr 26<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Friends-don't-let-friends-use-the-default-struct-postblit">Friends don't let friends use the default struct postblit
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Dec 28<span class="sub">th</span> 2015, created Sep 6<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Falsey-values">Falsey values
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Dec 19<span class="sub">th</span> 2015, created Jan 15<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Extend-a-struct-with-alias-this">Extend a struct with alias this
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Nov 28<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Embed-a-dynamic-library-in-an-executable">Embed a dynamic library in an executable
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Nov 28<span class="sub">th</span> 2015, created Jan 4<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Custom-format()-for-builtin-types">Custom format() for builtin types
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Nov 28<span class="sub">th</span> 2015, created Jun 8<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Bypassing-@nogc">Bypassing @nogc
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Nov 28<span class="sub">th</span> 2015, created Jun 7<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Minimum-or-maximum-of-numbers">Minimum or maximum of numbers
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Oct 25<span class="sub">th</span> 2015, created Jan 4<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Precise-timestamps-in-milliseconds">Precise timestamps in milliseconds
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Oct 6<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#How-the-D-Garbage-Collector-works">How the D Garbage Collector works
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Oct 4<span class="sub">th</span> 2015, created Feb 14<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#D-online-resources">D online resources
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Sep 1<span class="sub">st</span> 2015, created Jan 8<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Smallest-dub.json-for-an-executable">Smallest dub.json for an executable
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Aug 25<span class="sub">th</span> 2015, created Jan 8<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Capturing-with-regular-expressions">Capturing with regular expressions
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Aug 24<span class="sub">th</span> 2015, created Jan 29<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Patching-a-library-available-on-the-DUB-registry">Patching a library available on the DUB registry
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Aug 6<span class="sub">th</span> 2015, created Jan 7<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Adding-or-removing-an-element-from-arrays">Adding or removing an element from arrays
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified May 20<span class="sub">th</span> 2015, created Mar 22<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Skip-initialization-with-=-void">Skip initialization with = void
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created May 16<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#if-(__ctfe)">if (__ctfe)
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Apr 26<span class="sub">th</span> 2015, created Feb 22<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Grouping-modules-with-package.d">Grouping modules with package.d
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Mar 22<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Should-I-use-++pre-increment-or-post-increment++&#x3F;">Should I use ++pre-increment or post-increment++&#x3F;
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Mar 22<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#&#x2F;+-+&#x2F;-nestable-comments-and-version(none)">&#x2F;+ +&#x2F; nestable comments and version(none)
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Mar 22<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Unrecoverable-vs-recoverable-errors">Unrecoverable vs recoverable errors
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Feb 22<span class="sub">th</span> 2015, created Feb 12<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Recursive-Sum-Type-with-matching">Recursive Sum Type with matching
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 24<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Ensure-array-access-without-bounds-checking">Ensure array access without bounds checking
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 24<span class="sub">th</span> 2015, created Jan 7<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Implicit-conversion-for-user-defined-types">Implicit conversion for user-defined types
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 23<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#if-embedded-declaration">if embedded declaration
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 15<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Linking-with-C-gotchas">Linking with C gotchas
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 14<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Placement-new-with-emplace">Placement new with emplace
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 14<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#The-truth-about-shared">The truth about shared
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Created Jan 10<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Searching-for-a-substring-position">Searching for a substring position
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 8<span class="sub">th</span> 2015, created Jan 4<span class="sub">th</span> 2015
</span></div><div class="item-nav"><a href="#Inheriting-from-Exception">Inheriting from Exception
</a><span style=" color:rgb(158,158,158); font-size: 0.7em; float: right;"> Modified Jan 7<span class="sub">th</span> 2015, created Jan 4<span class="sub">th</span> 2015
</span></div></nav><div class="container"><a name="DIID-#1---Parse-XML-file"></a><div class="idiom"><a class="permalink" href="#DIID-#1---Parse-XML-file">Link
</a><h1 id="diid-1-parse-a-xml-file"> DIID #1 - Parse a XML file</h1>
<p><strong>Solution:</strong> Use the <code class="prettyprint">arsd-official:dom</code> package.
</p>
<h2 id="dub-json"> <code class="prettyprint">dub.json</code></h2>
<pre class="prettyprint"><code>{
    "name": "parse-xml-file",
    "dependencies":
    {
        "arsd-official:dom": "~&gt;10.0"
    }
}
</code></pre><h2 id="inventory-xml"> <code class="prettyprint">inventory.xml</code></h2>
<pre class="prettyprint"><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;inventory&gt;   
    &lt;stuff count="5"&gt;
        &lt;name&gt;melons&lt;/name&gt; 
    &lt;/stuff&gt;

    &lt;stuff count="8"&gt;
        &lt;name&gt;lemons&lt;/name&gt; 
    &lt;/stuff&gt;
&lt;/inventory&gt;
</code></pre><h2 id="source-main-d"> <code class="prettyprint">source/main.d</code></h2>
<pre class="prettyprint"><code>import std.file;
import std.conv;
import std.string;
import std.stdio;
import arsd.dom;

struct Stuff
{
    string name;
    int count;
}

void main()
{
    Stuff[] allStuff = parseStuff("inventory.xml");
 
    // Do things with stuff
    foreach(s; allStuff)
    {
        writefln("%s %s", s.count, s.name);
    }
}

Stuff[] parseStuff(string xmlpath)
{
    Stuff[] result;
    string content = cast(string)(std.file.read(xmlpath));
    auto doc = new Document();
    bool caseSensitive = true, strict = true;
    doc.parseUtf8(content, caseSensitive, strict);

    foreach (e; doc.getElementsByTagName("stuff"))
    {
        Stuff s;

        // Parse a mandatory attribute (throw if not there)
        s.count = e.getAttribute("count").to!int;

        // Parse sub-tags &lt;name&gt;
        foreach (e2; e.getElementsByTagName("name"))
        {
            s.name = e2.innerText.strip; // strip spaces inside &lt;name&gt;  myname &lt;/name&gt;
        }

        result ~= s;
    }

    return result;
}
</code></pre></div><a name="Renaming-a-module-with-backwards-compatibility"></a><div class="idiom"><a class="permalink" href="#Renaming-a-module-with-backwards-compatibility">Link
</a><h1 id="renaming-a-module-with-backwards-compatibility">Renaming a module with backwards compatibility</h1>
<p>It is easy to rename a function or object in D with the <code class="prettyprint">deprecated alias</code> idiom.
</p>
<pre class="prettyprint"><code>deprecated("Use myNewFun() instead") alias myOldFun = myNewFun; 

void myNewFun()
{
     // Show a deprecation message if called with myOldFun() name
}
</code></pre><p><code class="prettyprint"> deprecated</code> can also be used for module renaming.
</p>
<pre class="prettyprint"><code>deprecated("Import lib.newer.mod; instead") module lib.older.mod;

public import lib.newer.mod; 
</code></pre><p>However, at times you might want to write code that can work without deprecation message, with either the new or old module name.
</p>
<p>That is also possible:
</p>
<pre class="prettyprint"><code>static if (__traits(compiles, (){import my.renamed.mod;})) 
    import my.renamed.mod;
else
    import my.original.mod;
</code></pre><p>The origin of that idiom is unknown, but probably first appeared in the <a href="https://github.com/adamdruppe/arsd">arsd library</a>.
</p>
</div><a name="Emulating-Perl's-__DATA__"></a><div class="idiom"><a class="permalink" href="#Emulating-Perl's-__DATA__">Link
</a><h1 id="emulating-perl-s-data">Emulating Perl's <code class="prettyprint">__DATA__</code></h1>
<p>Using <code class="prettyprint"> import(__FILE__)</code> allows to embed data at the end of a D file.
</p>
<p>Here is an example from the <a href="https://forum.dlang.org/post/sniryeoaguvrwevzsvxc@forum.dlang.org">D newsgroups</a>: 
</p>
<pre class="prettyprint"><code>#! /usr/bin/env dub
/++ dub.sdl:
    dependency "dxml" version="0.4.0"
    stringImportPaths "."
+/
import dxml.parser;
import std;

enum text = import(__FILE__)
    .splitLines
    .find("__EOF__")
    .drop(1)
    .join("\n");

void main() {
    foreach (entity; parseXML!simpleXML(text)) {
        if (entity.type == EntityType.text)
            writeln(entity.text.strip);
    }
}
__EOF__
&lt;!-- comment --&gt;
&lt;root&gt;
    &lt;foo&gt;some text&lt;whatever/&gt;&lt;/foo&gt;
    &lt;bar/&gt;
    &lt;baz&gt;&lt;/baz&gt;
    more text
&lt;/root&gt;
</code></pre><p>See also: <a href="https://dlang.org/spec/lex.html#specialtokens">D lexer special tokens</a>.
</p>
</div><a name="GC-proof-resource-class"></a><div class="idiom"><a class="permalink" href="#GC-proof-resource-class">Link
</a><h1 id="gc-proof-resource-class">GC-proof resource class</h1>
<p>Class destructors have painful <a href="#The-trouble-with-class-destructors">limitations</a> when called by the GC.
</p>
<p>But there is a way to make a class holding a resource that:
</p>
<ul>
<li>works with scoped ownership (<code class="prettyprint">std.typecons.RefCounted</code>, <code class="prettyprint">std.typecons.Unique</code>, <code class="prettyprint">std.typecons.Scoped</code>)
</li>
<li>works with manual release (<code class="prettyprint">object.destroy</code>)
</li>
<li>warns when the GC call the destructor and then release the resource, which is <em>coincidental correctness</em> and dangerous to rely on.
</li>
</ul>
<p>The general idea behind the <strong>GC-proof resource class</strong> is to check why the destructor was called and act accordingly.
</p>
<pre class="prettyprint"><code>class MyGCProofResource
{
    void* handle;

    this()
    {
        // acquire resource
        handle = create_handle();
    }

    ~this()
    {
        // Important bit.
        // Here we verify that the GC isn't responsible
        // for releasing the resource, which is dangerous.
        import core.memory;
        assert(!GC.inFinalizer, "Error: clean-up of MyGCProofResource incorrectly" ~
                                " depends on destructors called by the GC");

        // release resource
        free_handle(handle);
    }
}
</code></pre><p>You'll get a clear message whenever you rely on the GC to release resources.
</p>
<p>This idiom was first introduced in the <a href="https://github.com/d-gamedev-team/gfm">GFM</a> library.
</p>
</div><a name="Don't-use-@property"></a><div class="idiom"><a class="permalink" href="#Don't-use-@property">Link
</a><h1 id="don-t-use-property">Don't use @property</h1>
<p>The current agreement on best practices with regards to <code class="prettyprint">@property</code> is to <strong>not use it.</strong>
</p>
<p><code class="prettyprint">@property</code> does very little and you can always avoid it.
</p>
</div><a name="Phobos-gems"></a><div class="idiom"><a class="permalink" href="#Phobos-gems">Link
</a><h1 id="phobos-gems">Phobos Gems</h1>
<p>There is no shortage of useful and surprising things in the D standard library.<br/>Here is some of the most useful stuff.
</p>
<h2 id="check-recoverable-errors-with-std-exception-enforce"> Check recoverable errors with <code class="prettyprint">std.exception.enforce</code></h2>
<p>It is good practice to check for unrecoverable errors with <code class="prettyprint">assert</code>, and recoverable errors with <code class="prettyprint">enforce</code>.<br/>Which means you should <a href="#Unrecoverable-vs-recoverable-errors">learn the difference</a> between those two types of errors.
</p>
<p>See: <a href="http://dlang.org/phobos/std_exception.html#.enforce">http://dlang.org/phobos/std_exception.html#.enforce</a>
</p>
<h2 id="explicit-destructor-call-with-object-destroy"> Explicit destructor call with <code class="prettyprint">object.destroy()</code></h2>
<p>Whenever you want to destroy an object manually, <code class="prettyprint">destroy()</code> is probably what you want.<br/>As a part of <code class="prettyprint">object.d</code>, it is always available.
</p>
<p>See: <a href="http://dlang.org/phobos/object.html#.destroy">http://dlang.org/phobos/object.html#.destroy</a>
</p>
<h2 id="allocate-a-class-object-on-stack-with-std-typecons-scoped"> Allocate a class object on stack with <code class="prettyprint">std.typecons.scoped</code></h2>
<p><code class="prettyprint">scoped</code> replaces <code class="prettyprint">new</code> and put a <code class="prettyprint">class</code> object on the stack, with the double benefit of avoiding GC and performing deterministic destruction.
</p>
<pre class="prettyprint"><code>import std.typecons;
auto myClass = scoped!MyClass(); // no need for 'new', and automatic destructor call at scope exit.
</code></pre><p>See: <a href="http://dlang.org/phobos/std_typecons.html#.scoped">http://dlang.org/phobos/std_typecons.html#.scoped</a>
</p>
<h2 id="remove-type-qualifiers-with-std-traits-unqual"> Remove type qualifiers with <code class="prettyprint">std.traits.Unqual</code></h2>
<p><code class="prettyprint">Unqual</code> enables to write template and instantiate them with <code class="prettyprint">const(T)</code>, <code class="prettyprint">immutable(T)</code>, <code class="prettyprint">shared(T)</code>&hellip;
</p>
<p>See: <a href="http://dlang.org/phobos/std_traits.html#.Unqual">http://dlang.org/phobos/std_traits.html#.Unqual</a>
</p>
<h2 id="convert-a-range-to-a-dynamic-array-with-std-array-array"> Convert a range to a dynamic array with <code class="prettyprint">std.array.array</code></h2>
<p><code class="prettyprint">array</code> is usually used to convert a range computation to a dynamic array.
</p>
<p>See: <a href="http://dlang.org/phobos/std_array.html#.array">http://dlang.org/phobos/std_array.html#.array</a>
</p>
<h2 id="more-phobos-gems"> More Phobos gems</h2>
<ul>
<li><p><a href="http://nomad.so/2014/08/hidden-treasure-in-the-d-standard-library/">Hidden treasure in the D standard library</a>
</p>
</li>
<li><p><a href="http://nomad.uk.net/articles/more-hidden-treasure-in-the-d-standard-library.html">http://nomad.uk.net/articles/more-hidden-treasure-in-the-d-standard-library.html</a>
</p>
</li>
</ul>
</div><a name="Parallel-foreach"></a><div class="idiom"><a class="permalink" href="#Parallel-foreach">Link
</a><h1 id="parallel-foreach">Parallel foreach</h1>
<p>This performs a parallel loop with a default task pool.
</p>
<pre class="prettyprint"><code>import core.atomic;
import std.parallelism;
import std.range;

void main()
{
    shared(int) A = 0;
    foreach(n; iota(2000).parallel)
    {
        atomicOp!"+="(A, 1);
    }
    assert(A == 2000);
}
</code></pre></div><a name="Unittests-with-optimizations-&#x3A-the-Final-Frontier"></a><div class="idiom"><a class="permalink" href="#Unittests-with-optimizations-&#x3A-the-Final-Frontier">Link
</a><h1 id="unittests-with-optimizations-the-final-frontier">Unittests with optimizations: the Final Frontier</h1>
<p>DUB is an essential piece of the modern D language experience. <strong>However,</strong> that experience doesn't include <em>"Running unit tests with optimizations"</em> by default.
</p>
<p>So, how do you avoid surprises in production? What would Kent Beck do?
</p>
<p><strong>In this post, we unleash the jaleously-guarded secret behind the most successful organizations in the world: running unittests with optimizations ON and OFF.</strong> 
</p>
<h2 id="changes-to-dub-json"> Changes to <code class="prettyprint">dub.json</code></h2>
<p>Create a new build type with the proper flags. This is also a good way to get to know the discreet <code class="prettyprint">"buildTypes"</code>.
</p>
<pre class="prettyprint"><code>"buildTypes": 
{
    "unittest-opt": 
    {
        "buildOptions": ["unittests", "optimize", "inline"]
    }
}
</code></pre><p><strong>Because it doesn't have a</strong> <code class="prettyprint">-release</code> <strong>flag</strong>, <a href="#So-what-does--release-do,-exactly?">asserts will still be enabled</a>. Hence, the <code class="prettyprint">unittest</code> content is here.
</p>
<p>(Please, don't call this configuration <code class="prettyprint">unittest-release</code>. Because flag <code class="prettyprint">-release</code> not being there is the one important thing. This increase the confusion between "release" and "optimizations").
</p>
<h2 id="run-both-versions"> Run both versions</h2>
<pre class="prettyprint"><code>$ dub test 
$ dub test -b unittest-opt
</code></pre><p>You are now listed in Forbes.
</p>
</div><a name="One-does-not-simply-call-new-for-static-arrays"></a><div class="idiom"><a class="permalink" href="#One-does-not-simply-call-new-for-static-arrays">Link
</a><h1 id="one-does-not-simply-call-new-for-static-arrays">One does not simply call <code class="prettyprint">new</code> for static arrays</h1>
<p>It just happens that in D you can't use <code class="prettyprint">new</code> to get a pointer to a newly allocated static array.
</p>
<pre class="prettyprint"><code>void main()
{
    alias T = int[4];

    // This line does not compile!
    // Error: new can only create structs, dynamic arrays or class objects, not int[4]'s
    auto t = new T; 
}
</code></pre><p><em>"You can only call new with structs, dynamic arrays, and class objects"</em> says the compiler.
</p>
<p><strong>Unrelated:</strong> actually the compiler is lying a bit, since it is possible to allocate a single (builtin type) value on the heap:
</p>
<pre class="prettyprint"><code>void main()
{
    int* p = new int;  // Works
}
</code></pre><p>But this can't be with static arrays, despite them being <a href="#Static-arrays-are-value-types">value types</a>. Doesn't that sound like an inconsistency? Something that would have to be <strong>explained.</strong>
</p>
<h2 id="why"> Why?</h2>
<p>The reasoning for <code class="prettyprint">new</code> and static arrays was probably that you rarely really want to allocate a static array on the heap; it could just as well be a slice.
</p>
<p><strong>So there is no syntax to do this</strong>.<br/>When you do write <code class="prettyprint">new int[4]</code> this will instead return an <code class="prettyprint">int[]</code> <em>slice</em> with a length of 4, which adds the benefits of holding a length.
</p>
<pre class="prettyprint"><code>writeln(typeof(new int[4]).stringof); // output: "int[]"

auto arr = new int[4];
writeln(arr.length); // output: "4"
arr ~= 42;
writeln(arr.length); // output: "5"
</code></pre><p>So far, so good. 
</p>
<p><a href="#Type-qualifiers-and-slices-creation">It gets weirder</a> whenever <code class="prettyprint">shared</code>, <code class="prettyprint">const</code> and <code class="prettyprint">immutable</code> get introduced...
</p>
<h2 id="do-it-anyway"> Do it anyway</h2>
<p>If for some reason you really need a <em>static</em> array allocated on the heap instead of a slice, you can do it anyway by using <code class="prettyprint">std.experimental.allocator</code> (or its DUB equivalent <a href="https://code.dlang.org/packages/stdx-allocator">stdx-allocator</a>):
</p>
<pre class="prettyprint"><code>import std.experimental.allocator;

void main()
{
    alias T = int[4];

 // T* t = new T;                 // Won't work.
    T* t = theAllocator.make!T;   // Fine!
    assert((*t).length == 4);     // Safe too.

    (*t)[1] = 42;                 // Needs pointer dereference and parentheses before use.
    assert(*t == [0, 42, 0, 0]);  // Features default initialization.
    
 // (*t) ~= 43; // Error: cannot append type int to type int[4]
}
</code></pre><p><em>This idiom got some help from Bastiaan Veelo.</em>
</p>
</div><a name="Contributing-back-with-money"></a><div class="idiom"><a class="permalink" href="#Contributing-back-with-money">Link
</a><h1 id="contributing-back-with-money">Contributing back with money</h1>
<p>While the D phenomenon relies primarily on benevolent effort, a bit of money can go a long way towards enhancing documentation, supporting libraries, compilers and IDEs.
</p>
<p><strong>If your company depends on a healthy D ecosystem</strong>, your donations will have a noticeable impact in spreading D to the programming world, while hedging against related technology risks.
</p>
<h2 id="the-d-foundation"> The D Foundation</h2>
<p>The <a href="https://dlang.org/foundation/donate.html">D Language Foundation</a> is a 501(c) non-profit public charity devoted to advancing open source technology related to the D programming language.
</p>
<p>A one-stop shop for pushing the interests of the D world at large.
</p>
<p>You can contribute for free through Amazon Smile! <a href="https://forum.dlang.org/thread/pikn41$u9q$1@digitalmars.com">https://forum.dlang.org/thread/pikn41$u9q$1@digitalmars.com</a>
</p>
<h2 id="ldc"> LDC</h2>
<p><a href="https://github.com/ldc-developers/ldc">The LDC project</a> is pivotal to many D companies that profit from top performance.<br/>If you are one of them, consider giving back to this critical piece of infrastructure...
</p>
<h2 id="solo-developers"> Solo developers</h2>
<ul>
<li><p>Adam D. Ruppe is the creator of <a href="http://dpldocs.info/">http://dpldocs.info/</a> (online and fast documentation for any DUB package) and author of D Cookbook. <a href="https://www.patreon.com/adam_d_ruppe/overview">https://www.patreon.com/adam<em>d</em>ruppe/overview</a>
</p>
</li>
<li><p>Basile B creates <a href="https://github.com/BBasile/Coedit">Coedit</a>, an IDE specially purposed for D (donation link on the Github page).
</p>
</li>
<li><p>WebFreak creates <a href="https://marketplace.visualstudio.com/items?itemName=webfreak.code-d#overview">code-d</a> a Visual Studio Code extension for dlang: <a href="https://www.patreon.com/WebFreak/overview">https://www.patreon.com/WebFreak/overview</a>
</p>
</li>
</ul>
<p><em>Let us know if you identify other ecosystem contributors with a donation link!</em>
</p>
</div><a name="Working-with-files"></a><div class="idiom"><a class="permalink" href="#Working-with-files">Link
</a><h1 id="working-with-files">Working with files</h1>
<p>See <a href="http://nomad.uk.net/articles/working-with-files-in-the-d-programming-language.html">this article</a>, the best reference on the topic.
</p>
</div><a name="Voldemort-types"></a><div class="idiom"><a class="permalink" href="#Voldemort-types">Link
</a><h1 id="voldemort-types">Voldemort types</h1>
<p>A <em>Voldemort type</em> is simply a type that can't be named by the user.
</p>
<h2 id="an-example-from-ae-utils-graphics"> An example from <code class="prettyprint">ae.utils.graphics</code>:</h2>
<pre class="prettyprint"><code>template procedural(alias formula)
{
    alias fun = binaryFun!(formula, "x", "y");
    alias Color = typeof(fun(0, 0));

    // Returning auto is necessary here.
    // Procedural can't be named outside of the procedural function.
    auto procedural()
    {
        struct Procedural
        {
            auto ref Color opIndex(int x, int y)
            {
                return fun(x, y);
            }
        }
        return Procedural();
    }
}
</code></pre><p>Outside of the <code class="prettyprint">procedural</code> function of this <a href="#Eponymous-templates">eponymous template</a>, there is no way to name <code class="prettyprint">Procedural</code>. Therefore, <strong>Voldemort types can only be passed around in auto variables or auto returns.</strong>
</p>
<h2 id="why"> Why?</h2>
<p>Hiding information about types. Because the user can't name or instantiate Voldemort types at will, expressions in a Voldemort lazy computation chain can change types without changing user code.
</p>
<p>Voldemort types were promoted and named by Andrei Alexandrescu. They are typically used in chains of lazy computations, like ranges.
</p>
<p>See also: <a href="http://www.drdobbs.com/cpp/voldemort-types-in-d/232901591">Voldemort Types in D</a>
</p>
</div><a name="Type-qualifiers-and-slices-creation"></a><div class="idiom"><a class="permalink" href="#Type-qualifiers-and-slices-creation">Link
</a><h1 id="type-qualifiers-and-slices-creation">Type qualifiers and slices creation</h1>
<p>When a slice is created with <code class="prettyprint">new</code> and a type qualifier, the qualifier applies to <em>pointed elements</em> <br/>instead of the whole slice as would be expected.
</p>
<pre class="prettyprint"><code>import std.stdio;

void main(string[] args)
{
    // Output: "const(int)[]"
    writeln(typeof(new const(int[4])).stringof);
    
    // Output: "immutable(int)[]"
    writeln(typeof(new immutable(int[4])).stringof);
    
    // Output: "shared(int)[]"
    writeln(typeof(new shared(int[4])).stringof);
}
</code></pre><p><strong>Note:</strong> this syntax <a href="#One-does-not-simply-call-new-for-static-arrays">doesn't return pointers to static arrays</a> but indeed return a slice.
</p>
<p><em>This peculiarity was emphasized at DConf 2018 by Andrei Alexandrescu.</em>
</p>
</div><a name="Static-arrays-are-value-types"></a><div class="idiom"><a class="permalink" href="#Static-arrays-are-value-types">Link
</a><h1 id="static-arrays-are-value-types">Static arrays are value types</h1>
<p><em>(Note: on this whole website, with "static arrays" we mean fixed-size arrays, not arrays declared with</em> <code class="prettyprint">static</code><em>).</em>
</p>
<p>It's important to note that D static arrays are value types.
</p>
<pre class="prettyprint"><code>void addFour(int[16] arr)
{
    arr[] += 4;           // Only the local version is modified.
}

void main()
{
    int[16] a;
    addFour(a);           // a is passed by value on the stack, not by pointer.
    assert(a[0] == 0);
}
</code></pre><p>That makes such declaration a trap when porting functions from C or C++.
</p>
<h2 id="static-arrays-convert-implicitely-into-slices"> Static arrays convert implicitely into slices!</h2>
<p>To pass static arrays by reference, either write a function taking a slice or use ref.
</p>
<pre class="prettyprint"><code>void addFive(ref int[16] arr)
{
    arr[] += 5;           // Caller parameter modified.
}

void addSix(int[] arr)
{
    arr[] += 6;           // Caller parameter modified.
}

void main()
{
    int[16] a;
    addFive(a);         // Works, a is passed by reference
    addSix(a);          // Works, a is converted into a slice referencing the same data
}
</code></pre><p>One of the oddities about static arrays is that <a href="#One-does-not-simply-call-new-for-static-arrays">you can't <code class="prettyprint">new</code> them</a>.
</p>
</div><a name="So-what-does--debug-do,-exactly&#63;"></a><div class="idiom"><a class="permalink" href="#So-what-does--debug-do,-exactly&#63;">Link
</a><h1 id="so-what-does-debug-do-exactly">So what does <code class="prettyprint">-debug</code> do, exactly?</h1>
<p>In D compilers, the <code class="prettyprint">-debug</code> switch does <strong>only one thing</strong>: compiling in code in <code class="prettyprint">debug</code> clauses.
</p>
<pre class="prettyprint"><code>debug
{
    writeln("-debug was used");
}
else
{
    writeln("-debug was NOT used");   
}
</code></pre><ul>
<li><p>The <code class="prettyprint">-debug</code> switch has <strong>nothing to do with debug information (-g)</strong> of lack thereof.
</p>
</li>
<li><p>The <code class="prettyprint">-debug</code> switch has <strong>nothing to do with optimizations (-O)</strong> or lack thereof.
</p>
</li>
<li><p>The <code class="prettyprint">-debug</code> switch has <strong>nothing to do with the -release switch</strong>, in fact both switches can be used at once, or none.
</p>
</li>
<li><p><strong>There is no "debug mode" or "release mode" in D compilers</strong>, those are a DUB convention.
</p>
</li>
</ul>
<h2 id="debug-identifiers-who-are-they-and-what-do-they-want"> <code class="prettyprint">debug</code> identifiers: who are they and what do they want?</h2>
<p>You can define a "debug identifier" <code class="prettyprint">ident</code> that will be compiled in if <code class="prettyprint">-debug=ident</code> is passed through the command-line.
</p>
<pre class="prettyprint"><code>debug(complicatedAlg)
    writeln("-debug=complicatedAlg was used"); // useful for debug logging
else
    writeln("-debug=complicatedAlg was NOT used");
</code></pre><p>That makes <code class="prettyprint">debug</code> remarkedly similar to... <code class="prettyprint">version</code>.
</p>
<h2 id="debug-is-indeed-strikingly-similar-to-version"> <code class="prettyprint">debug</code> is indeed strikingly similar to <code class="prettyprint">version</code></h2>
<p>The <strong>2 key differences</strong> between <code class="prettyprint">-debug</code> and <code class="prettyprint">-version</code> are:
</p>
<ul>
<li><p>Semantic: <code class="prettyprint">version</code> is for software features, and <code class="prettyprint">debug</code> is to enable logging/information/statistics... about programs with no user-facing effect.
</p>
</li>
<li><p>Quick printf-debugging: under a <code class="prettyprint">debug</code> clause, you don't have to follow <code class="prettyprint">pure</code>, <code class="prettyprint">nothrow</code>, <code class="prettyprint">@nogc</code> or <code class="prettyprint">@safe</code>. It's a special case in the compiler to enable debug logging.
</p>
</li>
</ul>
<p><strong>Breaking</strong> <code class="prettyprint">pure</code>/<code class="prettyprint">@nogc</code>/<code class="prettyprint">nothrow</code>/<code class="prettyprint">@safe</code> <strong>with</strong> <code class="prettyprint">-debug</code> <strong>is Undefined Behaviour</strong>, though in most cases it will work just fine and you don't have to worry. Just <strong>don't ship code with -debug</strong> enabled.
</p>
<p>Read more about <code class="prettyprint">-debug</code>: <a href="https://dlang.org/dmd-windows.html#switch-debug">https://dlang.org/dmd-windows.html#switch-debug</a>
</p>
</div><a name="Differences-in-integer-handling-vs-C"></a><div class="idiom"><a class="permalink" href="#Differences-in-integer-handling-vs-C">Link
</a><h1 id="differences-in-integer-handling-vs-c">Differences in integer handling vs C</h1>
<p>By and large D integer handling is identical to C. However there are some differences you might want to be aware of.
</p>
<p>By design, <strong>none of those can break C code ported to D.</strong>
</p>
<h2 id="operator"> <code class="prettyprint">&gt;&gt;&gt;</code> operator</h2>
<p>D has a <code class="prettyprint">&gt;&gt;&gt;</code> operator to force unsigned right bit-shifting, regardless of the type of the left operand.
</p>
<pre class="prettyprint"><code>import std.stdio;

void main()
{
    short i = -48;
    writeln(i &gt;&gt;  1);                                     // Output: -24

    // unsigned shift, regardless of signedness of i
    writeln(i &gt;&gt;&gt; 1);                                     // Output: 2147483624

    writeln(typeof(i &gt;&gt;&gt; 1).stringof);                    // Output: int
}
</code></pre><p>The <code class="prettyprint">&gt;&gt;&gt;</code> operator promotes integers like the other bit-shifting operators.
</p>
<h2 id="signed-overflow-is-not-undefined-behaviour"> Signed overflow is not Undefined Behaviour</h2>
<p>In D signed integer overflow is well-defined with wrapping semantics. You can rely on it and don't have to avoid signed overflow.
</p>
<p>Source: <a href="https://forum.dlang.org/post/n23bo3$qe$1@digitalmars.com">https://forum.dlang.org/post/n23bo3$qe$1@digitalmars.com</a>
</p>
</div><a name="Games-made-with-D"></a><div class="idiom"><a class="permalink" href="#Games-made-with-D">Link
</a><h1 id="games-made-with-d">Games made with D</h1>
<h2 id="quantum-break"> Quantum Break</h2>
<p><a href="http://www.quantumbreak.com/">Quantum Break</a> is an AAA video game developed by Remedy Entertainment (2016).<br/>Is it written in C++ with D as the scripting language. Available on Xbox One and Windows.
</p>
<p>See:
</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=OLFBal4Qo_k">Quantum Break: AAA Gaming With Some D Code</a>
</li>
<li><a href="https://www.youtube.com/watch?v=FKceA691Wcg">Using D Alongside a Game Engine by Manu Evans</a>
</li>
<li><a href="https://github.com/Remedy-Entertainment/binderoo">Binderoo</a> the binding library
</li>
</ul>
<h2 id="mayhem-intergalactic"> Mayhem Intergalactic</h2>
<p><a href="http://www.inventivedingo.com/mayhemig">Mayhem Intergalactic</a> is the first ever commercial video game written in D (2007).<br/>Available for Windows.<br/>See the <a href="http://forum.dlang.org/post/fjakft$cv4$1@digitalmars.com">newsgroup announcement</a>.
</p>
<h2 id="kenta-cho-s-games"> Kenta Cho's games</h2>
<p>Kenta Cho released a number of Windows shooter games in early D.
</p>
<ul>
<li><a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/tt_e.html">Torus Trooper</a>
</li>
<li><a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/tf_e.html">TUMIKI Fighters</a>
</li>
<li><a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/ttn_e.html">Titanion</a>
</li>
<li><a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/mcd_e.html">Mu-cade</a>
</li>
<li><a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/gr_e.html">Gunroar</a>
</li>
<li><a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/p47_e.html">PARSEC47</a>
</li>
<li><a href="http://www.asahi-net.or.jp/~cs8k-cyu/windows/a7xpg_e.html">A7Xpg</a>
</li>
</ul>
<h2 id="atrium"> Atrium</h2>
<p><a href="https://github.com/gecko0307/atrium">Atrium</a> is an unfinished first-person game with physics based puzzles, entirely written with the D programming language.
</p>
<h2 id="vibrant"> Vibrant</h2>
<p><a href="http://store.steampowered.com/app/712430/Vibrant/">Vibrant</a> is an arena shooter based on 2D dogfighting. Available for Windows and OS X on Steam.
</p>
<h2 id="jan-jurzitza-s-games"> Jan Jurzitza's games</h2>
<p>Jan Jurzitza wrote several <a href="http://ludumdare.com/compo/author/webfreak001/">Ludum Dare entries</a>.
</p>
</div><a name="Everything-you-wanted-to-ask-about-struct-construction"></a><div class="idiom"><a class="permalink" href="#Everything-you-wanted-to-ask-about-struct-construction">Link
</a><h1 id="everything-you-wanted-to-ask-about-struct-construction">Everything you wanted to ask about <code class="prettyprint">struct</code> construction</h1>
<h2 id="isn-t-that-a-bit-complicated"> Isn't that a bit complicated?</h2>
<pre class="prettyprint"><code>struct MyStruct
{
    this(int dummy)
    {
    }
}


// This is explicit constructor call
MyStruct a = MyStruct(0);     

// This is an implicit constructor call
MyStruct b = 1;               

// Blit, and eventually postblit call if it is defined
MyStruct c = b;           

// Same as previous line, parameters created from existing structs
myFunction(c);                         

// Implicit call to `opAssign` with an `int` parameter, fails if it doesn't exist
a = 2;                        

// Implicit call to default opAssign, or a custom one with a `MyStruct` parameter
b = a;

// Same as previous line
// Except a temporary instance is created and destroyed on that line
c = MyStruct(3);


struct MyAggregateStruct
{
    // `MyStruct(0)` evaluated at CTFE, 
    // not during MyAggregateStruct construction!
    MyStruct a = MyStruct(0); 
}

</code></pre><h2 id="the-rules-to-remember"> The rules to remember</h2>
<ul>
<li><p><strong>Struct declarations are the one place in D where implicit construction can happen.</strong>
</p>
</li>
<li><p>Postblits only happen when a new struct is created from an existing one. If the destination already exists it's a regular <code class="prettyprint">opAssign</code> call instead.
</p>
</li>
<li><p>To avoid unnecessary copy-construction, either <code class="prettyprint">@disable</code> the post-blit or pass such a <code class="prettyprint">struct</code> by reference.
</p>
</li>
<li><p>When an aggregate is created, its members don't get constructed but default initialized with <code class="prettyprint">.init</code>. Default values for members gets evaluated using CTFE, and stuffed into <code class="prettyprint">.init</code>.
</p>
</li>
</ul>
</div><a name="Is-this-available-at-compile-time-or-runtime&#63;"></a><div class="idiom"><a class="permalink" href="#Is-this-available-at-compile-time-or-runtime&#63;">Link
</a><h1 id="should-this-property-be-available-at-compile-time-or-runtime">Should this property be available at compile-time or runtime?</h1>
<p>It is common in <a href="#Design-by-Introspection">Design by Introspection</a> to decide between a runtime value and a compile-time value.
</p>
<ul>
<li>"Should this image abstraction have a runtime or compile-time dimension?"
</li>
<li>"Should this sound abstraction have a runtime or compile-time duration?"
</li>
<li>"Should this allocator abstraction have a runtime or compile-time alignment?"
</li>
</ul>
<h2 id="a-hot-sample"> A hot sample</h2>
<p>For example, our generic example library will operate on a <code class="prettyprint">Volcano</code> concept.<br/>The only requirement is to have a <code class="prettyprint">.magma</code> property, be it compile-time or runtime, implicitely convertible to <code class="prettyprint">int</code>.
</p>
<pre class="prettyprint"><code>template isVolcano(S)
{
    enum bool isVolcano = hasMagma!S; // only requirement for now
}

template hasMagma(S)
{
    enum bool hasMagma = is(typeof(
        ()
        {
            S s = S.init;
            int d = s.magma; // need a magma property
        }));
}
</code></pre><h2 id="you-don-t-necessarily-have-to-choose"> You don't necessarily have to choose</h2>
<p>It turns out generic algorithms can work with both a runtime or compile-time <code class="prettyprint">.magma</code> property, <strong>with this simple C++ trick</strong>.
</p>
<pre class="prettyprint"><code>template hasStaticMagma(S)
{
    enum bool hasStaticMagma = hasMagma!S &amp;&amp; __traits(compiles, int[S.magma]);
}

void myVolcanoGenericAlgorithm(S) if (isVolcano!S)
{
    static if (hasStaticMagma!S)
    {
        // optimized version for statically known .magma ...
    }
    else
    {
        // plain version ...
    }
}
</code></pre><p>You aren't forced to choose runtime or static for your meta-programming design. This idiom enables faster code when some value is statically known, without necessarily hindering your design.
</p>
</div><a name="Slices-.capacity,-the-mysterious-property"></a><div class="idiom"><a class="permalink" href="#Slices-.capacity,-the-mysterious-property">Link
</a><h1 id="slices-capacity-the-mysterious-property">Slices <code class="prettyprint">.capacity</code>, the mysterious property</h1>
<p>Dynamic arrays aka slices in D have a <code class="prettyprint">.capacity</code> property: the maximum length the slice can reach before needing reallocation.
</p>
<pre class="prettyprint"><code>int[] arr = new int[10];
writeln(arr.capacity);
assert(arr.capacity &gt;= arr.length);
</code></pre><p>Since <code class="prettyprint">.capacity</code> is read-only, the <code class="prettyprint">.reserve</code> builtin property also exist to ensure allocation size. This is similar to C++'s <code class="prettyprint">std::vector::capacity()</code> and <code class="prettyprint">std::vector::reserve(size_t n)</code>. Handy!
</p>
<pre class="prettyprint"><code>T[] arr;
arr.reserve(N);
foreach(i ; 0..N)
  arr ~= expr(i);                        // guaranteed not to allocate in the loop
</code></pre><p>I hear you saying: <strong>"How is that possible since D slices are only a pointer and a length?"</strong><br/>There is a trick, getting that information relies on the GC, and slices pointing to non-GC memory will report a capacity of 0 which means reallocating is mandatory for appending.
</p>
<pre class="prettyprint"><code>char[16] hexChars = "0123456789abcdef";
char[] decChars = hexChars[0..10];
writeln(decChars.capacity);              // output '0' since decChars points to non-GC memory

decChars = decChars.dup;                 // makes a GC copy of the slice
writeln(decChars.capacity);              // outputs non-zero value now that decChars points to GC memory
</code></pre><h2 id="slices-and-dynamic-arrays-are-one-single-thing"> "Slices" and "Dynamic Arrays" are one single thing</h2>
<p>There is a tendency to call slices that own their memory "Dynamic Arrays"  and the ones that don't "Slices"; perhaps to map other languages to D. 
</p>
<p><strong>This is a harmful dichotomy.</strong> That a slice own or not its memory is purely derived from the pointed area.
</p>
</div><a name="Rvalue-references&#x3A;-Understanding-auto-ref-and-then-not-using-it"></a><div class="idiom"><a class="permalink" href="#Rvalue-references&#x3A;-Understanding-auto-ref-and-then-not-using-it">Link
</a><h1 id="rvalue-references-understanding-auto-ref-and-then-not-using-it">Rvalue references: Understanding <code class="prettyprint">auto ref</code> and then not using it</h1>
<h2 id="what-are-rvalue-references"> What are Rvalue references?</h2>
<p><em>"Rvalue references"</em>, known from C++, are a way to pass both Lvalues and Rvalues by reference.<br/>It looks like this:
</p>
<pre class="prettyprint"><code>#include &lt;iostream&gt;

struct Vector2f
{
    float x, y;

    explicit Vector2f(float x, float y) : x(x), y(y)
    {
    }
};

void foo(const Vector2f&amp; pos)
{
    std::cout &lt;&lt; pos.x &lt;&lt; '|' &lt;&lt; pos.y &lt;&lt; std::endl;
}

int main()
{
    Vector2f v(42, 23);
    foo(v);                   // Pass a Lvalue, works
    foo(Vector2f(42, 23));    // Pass a Rvalue, works as well
}
</code></pre><p>How do you achieve something similar in D?
</p>
<h2 id="understanding-auto-ref-parameters"> Understanding <code class="prettyprint">auto ref</code> parameters</h2>
<p>The canonical way to pass both Rvalues and Lvalues in D is to use <code class="prettyprint">auto ref</code> parameters in combination with templates.
</p>
<pre class="prettyprint"><code>
struct A
{
    int id;
}

void test(T)(auto ref T a)
{
}

//
// Case 1:
//
// This generates one function:
//
//      void test(ref A a) { ... }
//
// taking the argument by ref.
A a = A(42);
test(a);


//
// Case 2
//
// This generates another function:
//
//      void test(A a) { ... }
//
// taking the argument by value.
test(A(42));

</code></pre><p>What <code class="prettyprint">auto ref</code> does is generating two different versions of the function, one passing Lvalues by reference, and the other passing Rvalues by copy.
</p>
<p><strong>Wait!</strong> You may immediately notice two key differences with C++:
</p>
<ul>
<li>There are no Rvalue references: Rvalues are moved instead.
</li>
<li>In the worst case, using <code class="prettyprint">auto ref</code> may lead to template bloat with many such parameters.
</li>
</ul>
<p>You'll be relieved to know there is a way to mimic the C++ behaviour.
</p>
<h2 id="here-comes-the-trick"> Here comes the trick</h2>
<p>Let's define in our struct a <code class="prettyprint">byRef</code> method which return <code class="prettyprint">this</code> by reference.
</p>
<pre class="prettyprint"><code>import std.stdio;

mixin template RvalueRef()
{
    alias T = typeof(this); // typeof(this) get us the type we're in
    static assert (is(T == struct));

    @nogc @safe
    ref const(T) byRef() const pure nothrow return
    {
        return this;
    }
}

struct Vector2f
{
    float x, y;

    this(float x, float y) pure nothrow
    {
        this.x = x;
        this.y = y;
    }

    mixin RvalueRef;
}

void foo(ref const Vector2f pos)
{
    writefln("(%.2f|%.2f)", pos.x, pos.y);
}

void main()
{
    Vector2f v = Vector2f(42, 23);
    foo(v);                           // Works
    foo(Vector2f(42, 23).byRef);      // Works as well, and use the same function
}
</code></pre><p>By effectively converting the Lvalue into an Rvalue using the <code class="prettyprint">ref</code> storage class on a function return type, we can pass the <code class="prettyprint">Vector2f</code> to a function taking <code class="prettyprint">ref const</code> input.
</p>
<p><em>This idiom was written by</em> <a href="https://github.com/Dgame">Randy Schütt</a><em>.</em>
</p>
</div><a name="@nogc-Array-Literals&#x3A;-Breaking-the-Limits"></a><div class="idiom"><a class="permalink" href="#@nogc-Array-Literals&#x3A;-Breaking-the-Limits">Link
</a><h1 id="nogc-array-literals-breaking-the-limits">@nogc Array Literals: Breaking the Limits</h1>
<h2 id="array-literals-may-allocate"> Array literals may allocate</h2>
<p>The most vexing limitation of <code class="prettyprint">@nogc</code> is that array literals generally can't be used anymore.
</p>
<pre class="prettyprint"><code>void main() @nogc
{
    // Works: the array literal is used as a value.
    int[3] myStaticArray = [1, 2, 3]; 

    // Doesn't work.
    int[] myDynamicArray = [1, 2, 3];  // Error: array literal in @nogc function 
                                       // may cause GC allocation
}
</code></pre><p>Indeed, such literals may well <strong>allocate a new array on the GC heap</strong>.
</p>
<h2 id="the-little-template-that-could"> The little template that could</h2>
<p>Fortunately, like often in the D world, there is an easy work-around to lift the limitations.
</p>
<pre class="prettyprint"><code>T[n] s(T, size_t n)(auto ref T[n] array) pure nothrow @nogc @safe
{
    return array;
}

void main() @nogc
{
    int[] myDynamicArray = [1, 2, 3].s; // Slice that static array which is on stack

    // Use myDynamicArray...
}
</code></pre><h2 id="beware-of-the-stack-lifetime"> Beware of the stack lifetime</h2>
<p>That work-around slices the stack allocated array and turn it into a slice. This would lead to memory corruption if the reference escapes. 
</p>
<p>Do not fear! The compiler warns you of escaped references to the stack, even in unsafe D.
</p>
<pre class="prettyprint"><code>// This function is illegal
int[] doNotDoThat() @nogc
{
    return [1, 2, 3].s; // Error: escaping reference to stack allocated 
                        // value returned by s([1, 2, 3])
}
</code></pre><p>Instead, duplicate this slice <code class="prettyprint">@nogc</code>-style, for example with <code class="prettyprint">malloc</code>. <strong>You are now able to use array literals in</strong> <code class="prettyprint">@nogc</code> <strong>code.</strong>
</p>
<p><em>This idiom originated from</em> <a href="https://github.com/Dgame">Randy Schütt</a>. 
</p>
</div><a name="Compile-time-RNG"></a><div class="idiom"><a class="permalink" href="#Compile-time-RNG">Link
</a><h1 id="compile-time-rng">Compile-time RNG</h1>
<p>In January 2016, an anonymous programmer <a href="http://forum.dlang.org/post/suswwamqwdszocvkvjbc@forum.dlang.org">posted on the D forums</a> a Proof-of-Concept for a devious compile-time Random Number Generator.
</p>
<pre class="prettyprint"><code>/+ CTRNG
    Proof-Of-Concept Compile-Time Random Number Generator.
    Please never actually use this or anything like it.

    While doing some metaprogramming tomfoolery, I stumbled into an
    interesting scenario. It occurred to me that with some work, I could
    probably turn what I had into a functioning compile-time random
    number generator, despite D's restrictions on metaprogramming intended
    to keep things deterministic. Some of this may be obvious to you,
    some of it may be interesting. Whether or not any of this is a bug, I do
    not know. It probably isn't useful unless trying to sabotage a codebase.

    Note: This is specifically developed with minimal dependence on other
    modules (even standard ones), so some things are implemented in
    non-idiomatic (read: strange) ways.
+/

/+
    Step 1
    We need something useable as a seed. Luckily, D has __TIMESTAMP__, which
    reports time of build as a string in roughly the following format:

        Wed Jan 20 18:04:41 2016

    Specific contents of this function don't matter. All that matters is
    timestamp goes in, largish unsigned integers come out. Feel free to skip
    the implementation, it is not important. All that matters is that with
    this, we will be able to get a psuedo-random seed at compile-time.
    We *could* parse the timestamp accurately, but the rest of this is
    hackish, so why not make this hackish as well?
+/
ulong timestampToUlong(string stamp)
{
    ulong result;

    foreach_reverse(c; stamp)
    {
        result += c;
        result *= 10;
    }

    return result;
}

/+
    Step 2
    Next, we'll need the ability to track some sort of state. D is designed
    with the intention that compile-time constructs cannot have a useful
    permanent state, so this'll take some doing.

    For starters, we need something we can query that can give different
    results different times we call it (as in, impure). For this, we
    have the following templated enum. It is manifest constant giving
    the number of top-level members in the current module. However,
    this number can change as other templates and mixins are resolved.

    Technically, each instantiation is different, but because the dirty
    details are hidden inside the default parameter value, it can be used
    as if it should always be the same value.
+/
enum counter(size_t x = [__traits(allMembers, mixin(__MODULE__))].length)=x;

/+
    Step 3
    For step 2 to work, we also need the ability to add members in between
    uses of `counter`. These need to be uniquely named, so we will
    need a way to generate names. Step 2 already gave us a source of
    increasing numbers, so we can trivially generate names based on
    the value of `counter`. So, we define a method to yeild a string
    containing a new unique declaration that we can `mixin()`.
+/
char[] member(ulong x)
{
    char[] buf = "void[0] _X0000000000000000;".dup;
    enum mapping = "0123456789abcdef";
    foreach_reverse(i; buf.length-17 .. buf.length-1)
    {
        buf[i] = mapping[x &amp; 0xf];
        x &gt;&gt;= 4;
    }
    return buf;
}

/+
    Step 4
    This is just a simple wrapper combining `member` and `counter` under
    a single name, making it slightly easier to increment the counter.
+/
mixin template next()
{
    mixin(member(counter!()));
}

/+
    Step 5
    Finally, we define a simple XorShift64* RNG. We don't really
    have arbitrary mutable state (yet?), so this depends on the D
    compiler caching previous template instantiations.
    The first is a specialization introducing our seed.
    The second is how all subsequent xorShift instantiations are
    handled, again taking advantage of changing default parameters.
+/
template xorShift(size_t x = counter!())
{
    static if(x == 0)
    {
        enum xorShift = timestampToUlong(__TIMESTAMP__);
    }
    else
    {
        // Name previous result to reduce syntax noise.
        enum y = xorShift!(x-1);
        enum xorShift = 0x2545_f491_4f6c_dd1dUL
            * (((y ^ (y &gt;&gt; 12)) ^ ((y ^ (y &gt;&gt; 12)) &lt;&lt; 25))
            ^ (((y ^ (y &gt;&gt; 12)) ^ ((y ^ (y &gt;&gt; 12)) &lt;&lt; 25)) &gt;&gt; 27));
    }
}

/+
    Now, let's use it!
+/
// Two instantiantions of xorShift result in the same value
static assert(xorShift!() == xorShift!());

// However, we can save one value,
enum a = xorShift!();

// ... update the counter,
mixin next;

// ... and save another value,
enum b = xorShift!();

// ... and they will not be the same.
static assert(a != b);

/+ What's more, because we have a time based seed, they will
all be different every time you compile this code. +/
pragma(msg, a);
pragma(msg, b);

mixin next;

mixin template headsOrTails(size_t x)
{
    static if(x % 2 == 0)
    {
        pragma(msg, "Heads!");
    }
    else
    {
        pragma(msg, "Tails!");
    }
}

mixin headsOrTails!(xorShift!());

/+
    Conclusion
    This is a really simple proof of concept. A "better" version
    could use a recursively scanning counter implementation that
    looked for symbols tagged with a certain User-Defined attribute
    to allow advancing the RNG state inside structs and such.
    More complicated RNGs could be implemented in a similar way.
    There may be value in mixing in template specializations.

    But then again, all this code is evil and I won't be doing
    anything more with it.
+/
void main()
{
    // Don't do anything at runtime. Just make dpaste's linker happy.
}
</code></pre><p><a href="http://dpaste.dzfl.pl/668646ce6d71">See source code on DPaste...</a>.
</p>
</div><a name="Leveraging-TLS-for-a-fast-thread-safe-singleton"></a><div class="idiom"><a class="permalink" href="#Leveraging-TLS-for-a-fast-thread-safe-singleton">Link
</a><h1 id="leveraging-tls-for-a-fast-thread-safe-singleton">Leveraging TLS for a fast thread-safe singleton</h1>
<p>In D the declarations you reasonably thought would be globals, are instead put in Thread-Local Storage (TLS) unless marked with <code class="prettyprint">shared</code> or <code class="prettyprint">__gshared</code>. Each thread the runtime knows has its own independent copy of TLS things.
</p>
<pre class="prettyprint"><code>class A
{
    static int instanceCount = 0; // Caution: one per thread
}

</code></pre><h2 id="don-t-ask-what-tls-can-do-for-you-ask-what-you-can-do-with-tls"> Don't ask what TLS can do for you. Ask what you can do with TLS!</h2>
<p><strong>TLS is useful to avoid locks when accessing global state.</strong>
</p>
<p>In this example, we'll show how to leverage TLS to avoid a costly <code class="prettyprint">synchronized</code> block and still be thread-safe.
</p>
<pre class="prettyprint"><code>class FastSingleton
{
private:

    this()
    {
    }

    // TLS flag, each thread has its own
    static bool instantiated_;

    // "True" global
    __gshared FastSingleton instance_;

public:
    static FastSingleton get()
    {
        // Since every thread has its own instantiated_ variable,
        // there is no need for synchronization here.
        if (!instantiated_)
        {
            synchronized (FastSingleton.classinfo)
            {
                if (!instance_)
                {
                    instance_ = new FastSingleton();
                }
                instantiated_ = true;
            }
        }
        return instance_;
    }

}
</code></pre><p>This singleton implementation was taken from <a href="https://www.youtube.com/watch?v=yMNMV9JlkcQ">this talk</a> by David Simcha.
</p>
<p>If you find any other use for TLS, please send us your discoveries.
</p>
</div><a name="Smallest-valid-D-program"></a><div class="idiom"><a class="permalink" href="#Smallest-valid-D-program">Link
</a><h1 id="smallest-valid-d-program"> Smallest valid D program</h1>
<p>Only 13 bytes are necessary:
</p>
<pre class="prettyprint"><code>void main(){}
</code></pre><p>You don't necessarily need to write <code class="prettyprint">void main(string[] args){}</code>.
</p>
</div><a name="People-blogging-about-D"></a><div class="idiom"><a class="permalink" href="#People-blogging-about-D">Link
</a><h1 id="people-blogging-about-d">People blogging about D</h1>
<ul>
<li>The official D blog: <a href="https://dlang.org/blog/">https://dlang.org/blog/</a>
</li>
<li>Michael Parker's blog (Derelict author): <a href="http://dblog.aldacron.net/">http://dblog.aldacron.net/</a>
</li>
<li>Vladimir Panteleev's blog: <a href="http://blog.thecybershadow.net/">http://blog.thecybershadow.net/</a>
</li>
<li>Átila Neves's blog: <a href="https://atilanevesoncode.wordpress.com/">https://atilanevesoncode.wordpress.com/</a>
</li>
<li>Gary Willoughby's blog: <a href="http://nomad.so/tag/d/">http://nomad.so/tag/d/</a>
</li>
<li>The Art of Machinery: <a href="https://theartofmachinery.com/">https://theartofmachinery.com/</a>
</li>
</ul>
<p>Planet D is a blog aggregator much more complete than this list:<br/><a href="http://planet.dsource.org/">http://planet.dsource.org/</a>
</p>
</div><a name="So-what-do-module-declarations-do,-exactly&#63;"></a><div class="idiom"><a class="permalink" href="#So-what-do-module-declarations-do,-exactly&#63;">Link
</a><h1 id="so-what-do-module-declarations-do-exactly">So what do module declarations do, exactly?</h1>
<p>Module declarations are the things found at the top of modules.
</p>
<pre class="prettyprint"><code>module fancylib.interfaces; // this is a module declaration aka module directive
</code></pre><p>They seem simple enough, but elicit a number of questions in the long run:
</p>
<ul>
<li><p><em>What if we don't name them after their position in the file system?</em>
</p>
</li>
<li><p><em>What if we omit module declarations like some D programs do?</em>
</p>
</li>
</ul>
<h2 id="every-module-has-a-name"> Every module has a name</h2>
<p>Every module has a module name whether it has a <code class="prettyprint">module</code> declaration or not.
</p>
<p>If you don't use one, the compiler uses the file name by default, but <em>only</em> the file name. The path on the file system is in no way taken into account.
</p>
<p>Given a source file <code class="prettyprint">source/foo.d</code>, using the following declaration is the same as not using a module declaration at all:
</p>
<pre class="prettyprint"><code>module foo; // can be omitted for a file source/foo.d
</code></pre><p>However, you rarely want to omit module declarations, we'll see why.
</p>
<h2 id="module-names-role-in-import"> Module names role in <code class="prettyprint"> import</code></h2>
<p>When a module is imported, the compiler will search for it in D files directly given through the command-line. If this fails, it will append the module name to import directories (the paths given with <code class="prettyprint">-I</code>) in order to find such a file.
</p>
<pre class="prettyprint"><code>// Do I know such a module with this name?
// Can I find it in &lt;import-paths&gt;/mylib/foo/bar.d otherwise?
import mylib.foo.bar;
</code></pre><h2 id="if-you-need-to-remember-one-thing"> If you need to remember one thing</h2>
<p>Modules have two ways to be found:
</p>
<ul>
<li>Being passed directly on the command-line. In this case, modules can hold any name in the <code class="prettyprint">module</code> declaration, as long as such names are used consistently.
</li>
<li>Using the module name to search inside import directories given by <code class="prettyprint">-I</code>.
</li>
</ul>
<p>Unless your program is small and self-contained, you should prefer the latter, and use module names matching file pathes in the file-system.
</p>
<p>See also: <a href="https://dlang.org/spec/module.html#module_declaration">https://dlang.org/spec/module.html#module_declaration</a>
</p>
</div><a name="So-D-is-just-C++-with-a-Garbage-Collector&#63;"></a><div class="idiom"><a class="permalink" href="#So-D-is-just-C++-with-a-Garbage-Collector&#63;">Link
</a><h1 id="so-d-is-just-c-with-a-garbage-collector">So D is just C++ with a Garbage Collector?</h1>
<p>There is sometimes a perception in Internet forums that D is a mere repackaging of C++. D would bring more or less the same feature set with a more friendly syntax, and not bring any new possibility.
</p>
<p>The goal of this article is to provide counterpoints to this belief. D does allows some design that the community regards as new, alongside with the expected <a href="#How-does-D-improve-on-C++17?">incremental improvements</a>.
</p>
<p>Here is an edited list of things that D can do, and C++ can't.
</p>
<h2 id="static-introspection"> Static introspection</h2>
<p>Can this module be <code class="prettyprint">import</code>ed?<br/>Is this method <code class="prettyprint">const</code>?<br/>What is the list of all child classes of the given <code class="prettyprint">class</code>?
</p>
<p>Branded under the moniker <em>Design by Introspection</em>, static introspection applied to APIs enables code that abandon more type-safety in the quest for more genericity.
</p>
<p>Examples:
</p>
<ul>
<li><a href="#Design-by-Introspection">Design By Introspection</a>
</li>
<li><a href="#Enumerate-fields-with-__traits(allMembers)-and-static-foreach">Enumerate field at compile-time</a>
</li>
</ul>
<h2 id="full-on-ctfe"> Full-on CTFE</h2>
<p>Compile-Time Function Evaluation, patiently evolved from a "glorified constant folder", is ubiquitous in D. Endlessly applicable, it also requires very few explanations: just add <code class="prettyprint">enum</code> and you get it.<br/>Regular looking code, evaluated at compile-time, with only a few limitations: what's not to love?
</p>
<p>Examples:
</p>
<ul>
<li><p><a href="#Precomputed-tables-at-compile-time-through-CTFE">Pre-computed tables computed at compile-time</a>
</p>
</li>
</ul>
<h2 id="generative-abilities"> Generative abilities</h2>
<p>CTFE and deep type introspection would be nothing without the ability to generate code at compile-time easily.<br/>String mixins, templates, mixin templates, "static" <code class="prettyprint">foreach</code> are different way in which this can be achieved.
</p>
<p>Examples:
</p>
<ul>
<li><a href="#String-interpolation-as-a-library">String interpolation as a library</a>
</li>
<li><a href="#Embed-a-dynamic-library-in-an-executable">Using external files as data</a>
</li>
</ul>
<p>The combination of Static Introspection, generative features and CTFE forms the trinity that powers D's unique selling point. It's the fire behind the proverbial smoke.
</p>
</div><a name="The-trouble-with-class-destructors"></a><div class="idiom"><a class="permalink" href="#The-trouble-with-class-destructors">Link
</a><h1 id="the-trouble-with-class-destructors">The trouble with class destructors</h1>
<p>Despite having a GC, resource management in D is one of the most difficult point of the language.
</p>
<p>In particular, class destructors in D enjoy a variety of limitations you should be aware of.
</p>
<h2 id="1-don-t-expect-class-destructors-to-be-called-at-all-by-the-gc"> 1. Don't expect class destructors to be called at all by the GC</h2>
<p>The garbage collector is not guaranteed to run the destructors for all unreferenced objects.
</p>
<h2 id="2-don-t-expect-class-destructors-to-be-called-timely-and-by-the-right-thread"> 2. Don't expect class destructors to be called timely and by the right thread</h2>
<p>Class destructors might be called <strong>when a collect is performed</strong> which can be later than you wished and by <strong>any thread</strong> the GC is currently running on.
</p>
<h2 id="3-don-t-expect-members-to-be-valid-in-a-class-destructor"> 3. Don't expect members to be valid in a class destructor</h2>
<p>The order in which the garbage collector calls destructors for unreferenced objects is <em>not specified</em>. <strong>Don't use members in class destructors if you expect to be called by the GC.</strong>
</p>
<h2 id="4-don-t-allocate-within-a-destructor-called-by-the-gc"> 4. Don't allocate within a destructor called by the GC</h2>
<p>Using GC allocation is forbidden within a class destructor.
</p>
<h2 id="5-don-t-assume-a-class-destructor-won-t-be-called-because-the-constructor-threw-an-exception"> 5. Don't assume a class destructor won't be called because the constructor threw an exception.</h2>
<p>If a class constructor throw, the corresponding destructor <strong>will</strong> be called as part of the normal teardown sequence! Be prepared for this: your class destructor should check for object validity.
</p>
<h2 id="conclusion"> Conclusion</h2>
<p>All this is in sharp contrast with the deterministic way C++ deals with destructors. However, all these constraints go away if destructors are called manually using:
</p>
<ul>
<li><code class="prettyprint">std.typecons.scoped</code> (documentation <a href="http://dlang.org/phobos/std_typecons.html#.scoped">here</a>)
</li>
<li><code class="prettyprint">std.typecons.Unique</code> (documentation <a href="http://dlang.org/phobos/std_typecons.html#.Unique">here</a>)
</li>
<li>calling <a href="http://dlang.org/phobos/object.html#.destroy"><code class="prettyprint">destroy</code></a> on an object manually
</li>
<li>using <code class="prettyprint">delete</code> or <code class="prettyprint">scope class</code> (deprecated)
</li>
</ul>
<p><strong>TL;DR There is not much that can safely be done in a class destructor if called by the GC. A solution to this problem is</strong> <a href="#GC-proof-resource-class">GC-proof resource classes</a>.
</p>
<p>See: <a href="http://dlang.org/class.html">http://dlang.org/class.html</a>
</p>
</div><a name="Which-book-should-I-read&#63;"></a><div class="idiom"><a class="permalink" href="#Which-book-should-I-read&#63;">Link
</a><h1 id="which-book-should-i-read">Which book should I read?</h1>
<p><strong> "I'm already experienced with C++, Java or C#. I want to ramp up quickly with the best current practices."</strong>
</p>
<p>Try <a href="https://www.packtpub.com/application-development/learning-d">Learning D</a> by Mike Parker.
</p>
<p><strong> "I want examples of feature applications and usage, to see what D enables. Advanced stuff please." </strong>
</p>
<p>Try the <a href="https://www.packtpub.com/application-development/d-cookbook">D Cookbook</a> by Adam D. Ruppe.
</p>
<p><strong> "I want a whirlwind tour of D." </strong>
</p>
<p>Try <a href="http://erdani.com/index.php/books/tdpl/">The D Programming Language (TDPL)</a> by Andrei Alexandrescu.
</p>
<p><strong> "I want to learn how to program, with D."</strong>
</p>
<p>Try <a href="http://ddili.org/ders/d.en/">Programming In D</a> by Ali Cehreli.
</p>
<p><strong> "I want to do Web development, with D."</strong>
</p>
<p>Try <a href="https://www.packtpub.com/web-development/d-web-development">D Web Development</a> by Kai Nacke.
</p>
</div><a name="Four-ways-to-use-the-static-keyword-you-may-not-know-about"></a><div class="idiom"><a class="permalink" href="#Four-ways-to-use-the-static-keyword-you-may-not-know-about">Link
</a><h1 id="four-ways-to-use-the-static-keyword-you-may-not-know-about">Four ways to use the static keyword you may not know about</h1>
<p>The <code class="prettyprint">static</code> keyword is heavily re-used in the D language. With this uniquely detailed article, you'll learn to recognize the different species of <code class="prettyprint">static</code> in the wild.
</p>
<h2 id="1-most-obvious-static-member-functions-and-static-data-members"> 1. Most obvious: <code class="prettyprint">static</code> member functions and <code class="prettyprint">static</code> data members</h2>
<p>Much like in Java and C++, you can declare <code class="prettyprint">static</code> data and functions members in a <code class="prettyprint">struct</code> or a <code class="prettyprint">class</code>. The one caveat is that <strong>static data members will be put in Thread Local Storage unless marked with</strong> <code class="prettyprint">__gshared</code>.
</p>
<pre class="prettyprint"><code>class MyClass
{
    // A static member variable =&gt; only one exist for all MyClass instances
    // You need __gshared here else instanceCount would be thread-local
    static __gshared int instanceCount = 0;

    // A static member function =&gt; does not receive "this"
    static void incrementCount()
    {
        // Can't use "this" here
        instanceCount += 1;
    }
}

void main()
{
    import std.stdio;
    MyClass.incrementCount();
    writeln(MyClass.instanceCount); // Prints: "1"
}
</code></pre><p><strong>Additionally</strong>, <code class="prettyprint">static immutable</code> can be used instead of <code class="prettyprint">enum</code> to force compile-time evaluation of a constant, <strong>while keeping an address.</strong>
</p>
<p>This is especially useful for <a href="#Precomputed-tables-at-compile-time-through-CTFE">arrays computed at compile-time</a>.
</p>
<h2 id="2-top-level-static-variables-and-functions"> 2. Top-level <code class="prettyprint">static</code> variables and functions</h2>
<p>This is perhaps the strangest <code class="prettyprint">static</code> abuse. At top-level, <code class="prettyprint">static</code> does <strong>nothing</strong> for variables and function declarations.
</p>
<p>Here, a TLS (Thread Local Storage) variable:
</p>
<pre class="prettyprint"><code>// At top-level
static int numEngines = 4;          // Accepted. Does nothing.
</code></pre><p>This is 100% equivalent to:
</p>
<pre class="prettyprint"><code>// At top-level.
int numEngines = 4;                 // The normal way to declare a TLS variable.
</code></pre><p>Similarly for top-level functions:
</p>
<pre class="prettyprint"><code>static int add(int a, int b)        // You can leave out "static" at top-level. It does nothing.
{
    return a + b;
}
</code></pre><p>As the D specification <a href="http://dlang.org/spec/attribute.html#static">says</a>:
</p>
<p><em>"Static does not have the additional C meaning of being local to a file. Use the private attribute in D to achieve that."</em>
</p>
<p><strong>Leave your C++ knowledge about</strong> <code class="prettyprint">static inline</code> <strong>functions and</strong> <code class="prettyprint">static</code> <strong>top-level variables at the door: it doesn't apply here.</strong>
</p>
<h2 id="3-nested-static-struct-nested-static-class-and-nested-static-functions"> 3. Nested <code class="prettyprint">static struct</code>, nested <code class="prettyprint">static class</code>, and nested <code class="prettyprint">static</code> functions</h2>
<p><code class="prettyprint">static</code> can be put before nested <code class="prettyprint">struct</code>, <code class="prettyprint">class</code> or functions.
</p>
<p><strong>It means "I don't have a pointer to the outer context"</strong>.
</p>
<pre class="prettyprint"><code>import std.stdio;

void main()
{
    float contextData;

    struct InternalA
    {
        void uglyStuff()
        {
            // can access contextData here, and use this.outer
        }
    }

    static struct InternalB
    {
        void uglyStuff()
        {
            // cannot access contextData here, cannot use this.outer
        }
    }

    void subFunA()
    {
        // can access contextData here
    }

    static void subFunB()
    {
        // cannot access contextData here
    }

    writeln(typeof(&amp;subFunA).stringof); // Prints: "void delegate()"
    writeln(typeof(&amp;subFunB).stringof); // Prints: "void function()"
}
</code></pre><p><strong>To sum up</strong>, a nested <code class="prettyprint">static struct</code> or <code class="prettyprint">static class</code>:
</p>
<ul>
<li>Cannot access the parent context because it has no <code class="prettyprint">this.outer</code> property,
</li>
<li>Might be a bit smaller in memory because <code class="prettyprint">this.outer</code> is a hidden field.
</li>
</ul>
<p>A nested <code class="prettyprint">static</code> function:
</p>
<ul>
<li>Cannot access the parent context because it has no context pointer to the upper frame,
</li>
<li>Can fit in a simple <code class="prettyprint">function</code> pointer instead of a <code class="prettyprint">delegate</code> for this reason.
</li>
</ul>
<h2 id="4-global-constructors-and-global-destructors"> 4. Global constructors and global destructors</h2>
<p>Arguably the most important <code class="prettyprint">static</code> use out of the four we've listed.
</p>
<h3 id="thread-local-global-constructors-static-this"> <em>Thread-local</em> global constructors <code class="prettyprint">static this()</code>:</h3>
<p>Called when a thread is registered to the D runtime. <strong>Typically used to initialize TLS variables.</strong>
</p>
<h3 id="thread-local-global-destructor-static-this"> <em>Thread-local</em> global destructor <code class="prettyprint">static ~this()</code>:</h3>
<p>Called when a thread is unregistered to the D runtime. <strong>Typically used to finalize TLS variables.</strong>
</p>
<h3 id="global-constructors-shared-static-this"> Global constructors <code class="prettyprint">shared static this()</code>:</h3>
<p>Called when the D runtime is initialized. <strong>Typically used to initialize</strong> <code class="prettyprint">shared</code> <strong>or</strong> <code class="prettyprint">__gshared</code> <strong>variables</strong>, for example in <a href="https://github.com/DerelictOrg">Derelict</a>.
</p>
<h3 id="global-destructor-shared-static-this"> Global destructor <code class="prettyprint">shared static ~this()</code>:</h3>
<p>Called when the D runtime is finalized. <strong>Typically used to finalize</strong> <code class="prettyprint">shared</code> <strong>or</strong> <code class="prettyprint">__gshared</code> <strong>variables.</strong>
</p>
<p>Important: global constructors and global destructors can be placed within a <code class="prettyprint">struct</code> or a <code class="prettyprint">class</code>, where they will be able to initialize <code class="prettyprint">shared</code>, <code class="prettyprint">__gshared</code> or <code class="prettyprint">static</code> <em>members</em>.
</p>
<p><strong>Beware:</strong> It's a common mistake to write <code class="prettyprint">static this()</code> instead of <code class="prettyprint">shared static this()</code>. <strong>Don't be a TLS victim.</strong>
</p>
</div><a name="Optimal-AA-lookup"></a><div class="idiom"><a class="permalink" href="#Optimal-AA-lookup">Link
</a><h1 id="optimal-aa-lookup">Optimal AA lookup</h1>
<p>When used on an Associative Array, the <code class="prettyprint">in</code> operator returns either a pointer to the searched for element, or <code class="prettyprint">null</code> if not found.
</p>
<p>Instead of:
</p>
<pre class="prettyprint"><code>key in aa ? aa[key] : ValueType.init;
</code></pre><p>which perform 2 AA lookups prefer:
</p>
<pre class="prettyprint"><code>auto ptr = key in aa;
ptr ? *ptr : ValueType.init;
</code></pre><p>The <code class="prettyprint">.get</code> builtin property can also be used. It provides a default value when the key doesn't exist.
</p>
<pre class="prettyprint"><code>aa.get(key, defaultValue);
</code></pre><h2 id="reminder-aas-are-hashmaps-not-balanced-trees"> Reminder: AAs are hashmaps, not balanced trees!</h2>
<p>Associative arrays in D are akin to C++'s <code class="prettyprint">std::unordered_map</code>, <strong>not</strong> <code class="prettyprint">std::map</code>.
</p>
<p>See: <a href="https://dlang.org/spec/hash-map.html">https://dlang.org/spec/hash-map.html</a>
</p>
</div><a name="Porting-from-C-gotchas"></a><div class="idiom"><a class="permalink" href="#Porting-from-C-gotchas">Link
</a><h1 id="porting-from-c-gotchas">Porting from C gotchas</h1>
<h2 id="globals-must-be-marked-gshared"> Globals must be marked <code class="prettyprint">__gshared</code></h2>
<p>Variables at global scope are in Thread Local Storage (TLS) unless qualified with <code class="prettyprint">shared</code> or <code class="prettyprint">__gshared</code>. You are <a href="#The-truth-about-shared">probably</a> wanting to use <code class="prettyprint">__gshared</code>.
</p>
<pre class="prettyprint"><code>// A C global variable
int my_global_var;
</code></pre><pre class="prettyprint"><code>// Equivalent D global
__gshared int myGlobalVar;
</code></pre><h2 id="long-and-unsigned-long"> <code class="prettyprint">long</code> and <code class="prettyprint">unsigned long</code></h2>
<p>C's <code class="prettyprint">long</code> and <code class="prettyprint">unsigned long</code> have variable size, no builtin type is equivalent in D!
</p>
<p>The recommended way is to use <code class="prettyprint">c_long</code> and <code class="prettyprint">c_ulong</code> from module <code class="prettyprint">core.stdc.config</code>.
</p>
<pre class="prettyprint"><code>// A C function declaration
unsigned long countBeans(const long *n)
</code></pre><pre class="prettyprint"><code>// Equivalent D function declaration
import core.stdc.config;
c_ulong countBeans(const(c_long)* n);
</code></pre><p><code class="prettyprint">c_int</code> and <code class="prettyprint">c_uint</code> also exist to replace <code class="prettyprint">int</code> and <code class="prettyprint">unsigned int</code>, but because they are 32-bits in most architectures, it's usually simply translated with D's <code class="prettyprint">int</code> and <code class="prettyprint">uint</code> instead.
</p>
<h2 id="char"> <code class="prettyprint">char</code></h2>
<p>In C, the <code class="prettyprint">char</code> type can refer to either <code class="prettyprint">signed char</code> or <code class="prettyprint">unsigned char</code>, depending on the implementation.
</p>
<p>In D, <code class="prettyprint">char</code> is always an unsigned integer (0 to 255). If you need the equivalent of <code class="prettyprint">signed char</code>, use <code class="prettyprint">byte</code>.
</p>
<pre class="prettyprint"><code>// A C function declaration
unsigned char * computeBlurb(signed char *data);
</code></pre><pre class="prettyprint"><code>// Equivalent D function declaration
char* computeBlurb(byte* data);
</code></pre><h2 id="multi-dimensional-arrays-declarations"> Multi-dimensional arrays declarations</h2>
<pre class="prettyprint"><code>// A C array declaration
int myMatrix[4][2] = { { 1, 2}, { 3, 4}, { 5, 6}, { 7, 8} };
</code></pre><pre class="prettyprint"><code>// Equivalent D array declaration
int[2][4] myMatrix = [ [ 1, 2], [ 3, 4], [ 5, 6], [ 7, 8] ];
</code></pre><h2 id="enum-values-without-enum-namespace"> Enum values without enum namespace</h2>
<pre class="prettyprint"><code>// A C enum declaration
typedef enum
{
    STRATEGY_RANDOM,
    STRATEGY_IMMEDIATE,
    STRATEGY_SEARCH
} strategy_t;
</code></pre><pre class="prettyprint"><code>// Equivalent D enum declaration
alias strategy_t = int;
enum : strategy_t
{
    STRATEGY_RANDOM,
    STRATEGY_IMMEDIATE,
    STRATEGY_SEARCH
}
</code></pre><p>This avoids having to write <code class="prettyprint">strategy_t.STRATEGY_IMMEDIATE</code> instead of <code class="prettyprint">STRATEGY_IMMEDIATE</code> when porting C code.
</p>
<h2 id="anonymous-struct-and-union"> Anonymous <code class="prettyprint">struct</code> and <code class="prettyprint">union</code></h2>
<p>D provides a limited form of anonymous nested <code class="prettyprint">struct</code> and <code class="prettyprint">union</code>, but they can't be used to translate this C anonymous struct:
</p>
<pre class="prettyprint"><code>// A C anonymous struct
struct Foo
{
    struct
    {
        int x;
    } bar;
};
</code></pre><pre class="prettyprint"><code>// Equivalent D
struct Foo
{
    private struct bar_t
    {
        int x;
    }
    bar_t bar;
}
</code></pre><h2 id="convert-array-to-pointers-explicitely"> Convert array to pointers explicitely</h2>
<p>When porting from C, you will probably have to spam <code class="prettyprint">.ptr</code> anywhere an array is implicitely converted to a pointer.
</p>
<pre class="prettyprint"><code>// In C
void sum(const int *array, int n);
int coeff[16];
sum(coeff, sizeof(coeff) / sizeof(int));
</code></pre><pre class="prettyprint"><code>// In D
void sum(const(int)* array, int n);
int[16] coeff;
sum(coeff.ptr, coeff.sizeof / int.sizeof); // array not implicitely convertible to a pointer
</code></pre></div><a name="Precomputed-tables-at-compile-time-through-CTFE"></a><div class="idiom"><a class="permalink" href="#Precomputed-tables-at-compile-time-through-CTFE">Link
</a><h1 id="precomputed-tables-at-compile-time-through-ctfe">Precomputed tables at compile-time through CTFE</h1>
<p>D compilers provide extensive <a href="https://en.wikipedia.org/wiki/Compile_time_function_execution">Compile-Time Function Execution</a>.<br/>This feature allows to easily compute almost anything at compile-time, without using an external program.
</p>
<p>Here is an example of a precomputed array from the <a href="https://github.com/d-gamedev-team/gfm">GFM</a> library.
</p>
<pre class="prettyprint"><code>static immutable ushort[64] offsettable =
    (){
        ushort[64] t;
        t[] = 1024;        // Fills the table with 1024
        t[0] = t[32] = 0;
        return t;
    }();
</code></pre><p><strong>What is happening there?</strong>
</p>
<ul>
<li><p><code class="prettyprint">(){   /* body */   }</code> is short syntax for a <code class="prettyprint">delegate</code> literal returning <code class="prettyprint">auto</code> with no argument.
</p>
</li>
<li><p>So, <code class="prettyprint">(){   /* body */   }()</code> means that we call that <code class="prettyprint">delegate</code> immediately.
</p>
</li>
<li><p>the literal is executed at compile-time, as enforced by <code class="prettyprint">static immutable</code>.
</p>
</li>
</ul>
<p>But why not use <code class="prettyprint">enum</code> for this purpose?
</p>
<h2 id="if-you-must-remember-one-rule-from-this-article"> If you must remember one rule from this article</h2>
<p><strong>For large constants, prefer using</strong> <code class="prettyprint">static immutable</code> <strong>over</strong> <code class="prettyprint">enum</code><strong>.</strong>
</p>
<p>It's important that <code class="prettyprint">static immutable</code> is used in the previous example instead of just <code class="prettyprint">enum</code>. This will create a constant with an address.
</p>
<p><code class="prettyprint">enum</code> <strong> creates a compile-time only construct.</strong><br/><code class="prettyprint">static immutable</code> <strong> actually puts it in the static data segment.</strong>
</p>
<pre class="prettyprint"><code>// This example highlights the difference between "enum" and "static immutable" for constants.
import std.stdio;

bool amIInCTFE()
{
    return __ctfe;
}

void main()
{
    bool                  a = amIInCTFE(); // regular runtime initialization
    enum bool             b = amIInCTFE(); // forces compile-time evaluation with enum
    static immutable bool c = amIInCTFE(); // forces compile-time evaluation with static immutable

    writeln(a, " ", &amp;a);   // Prints: "false &lt;address of a&gt;"
    //writeln(b, " ", &amp;b); // Error: enum declarations have no address
    writeln(c, " ", &amp;c);   // Prints: "true &lt;address of c&gt;"
}
</code></pre><p>Using <code class="prettyprint">enum</code> would duplicate the constant at each call-site, which is inefficient for arrays and may even lead to allocations on use point in the same way than array literals allocate!
</p>
<p>This pre-computed fibonacci example fails to compile:
</p>
<pre class="prettyprint"><code>enum int[] fibTable =
    (){
        int[] t;
        t ~= 1;
        t ~= 1;
        int precomputedValues = 128;
        foreach(i; 2..precomputedValues)
            t ~= t[i - 1] + t[i - 2];
        return t;
    }();


int fibonacci(int n) pure @nogc
{
    if (n &lt; fibTable.length)  // Error: array literal in @nogc function fibonacci may cause GC allocation
        return fibTable[n];
    else
        return fibonacci(n - 1) + fibonacci(n - 2);
}
</code></pre><p>For all the other uses of <code class="prettyprint">static</code>, read <a href="#Four-ways-to-use-the-static-keyword-you-may-not-know-about">this article</a>.
</p>
</div><a name="Qualified-switch-using-with"></a><div class="idiom"><a class="permalink" href="#Qualified-switch-using-with">Link
</a><h1 id="qualified-switch-using-with">Qualified switch using "with"</h1>
<p>Let's say we have an enum:
</p>
<pre class="prettyprint"><code>enum MyEnum
{
    small,
    normal,
    huge
}
</code></pre><p>Switching on an enum value is annoying and redundant: <code class="prettyprint">MyEnum</code> has to be repeated for each case.
</p>
<pre class="prettyprint"><code>final switch(enumValue)
{
case MyEnum.small:
    writeln("small");
    break;
case MyEnum.normal:
    writeln("normal");
    break;
case MyEnum.huge:
    writeln("huge");
    break;
}
</code></pre><p>We can work-around this by using <code class="prettyprint">with</code>:
</p>
<pre class="prettyprint"><code>final switch(enumValue) with (MyEnum)
{
case small:
    writeln("small");
    break;
case normal:
    writeln("normal");
    break;
case huge:
    writeln("huge");
    break;
}
</code></pre><p>This idiom was discovered by <a href="https://github.com/deadalnix">Amaury Sechet</a>.
</p>
</div><a name="The-importance-of-being-pure"></a><div class="idiom"><a class="permalink" href="#The-importance-of-being-pure">Link
</a><h1 id="the-importance-of-being-pure">The importance of being <code class="prettyprint">pure</code></h1>
<p><code class="prettyprint">pure</code> is a good looking function attribute that unfortunately doesn't seem to provide much value at first sight. On the other hand, who doesn't want to write <code class="prettyprint">pure</code> code?
</p>
<p><strong>How can we justify the horizontal space investment in</strong> <code class="prettyprint">pure</code> <strong>annotations?</strong>
</p>
<h2 id="reason-1-purity-helps-with-alias-analysis"> <strong>Reason 1:</strong> Purity helps with alias analysis</h2>
<p>The compiler has to assume a non-<code class="prettyprint">pure</code> function could modify any global state:
</p>
<ul>
<li>global variables
</li>
<li>heap allocated by impure means
</li>
<li>I/O
</li>
<li>and so on
</li>
</ul>
<p>Let's say we have a function lacking a <code class="prettyprint">pure</code> annotation.
</p>
<pre class="prettyprint"><code>extern(C) int impureFibonacci(int n);
</code></pre><p>This function gets called.
</p>
<pre class="prettyprint"><code>int result = impureFibonacci(8);
// Any global state could have changed, like allocated heap, global variables, and so on.
// That's like a barrier for the optimizer.
</code></pre><p><strong>The compiler must assume any global state could have changed.</strong>
</p>
<h2 id="reason-2-pure-is-documentation"> <strong>Reason 2:</strong> <code class="prettyprint">pure</code> is documentation</h2>
<p>As dreadful as annotation streaks like <code class="prettyprint">pure const nothrow @nogc</code> can be, they <em>are</em> some kind of compiler-enforced documentation.
</p>
<h2 id="more-about-purity"> More about purity</h2>
<ul>
<li><p><a href="http://klickverbot.at/blog/2012/05/purity-in-d/">Purity in D</a> by David Nadlinger.
</p>
</li>
</ul>
<p><em>This article was written with the help of</em> <a href="https://github.com/deadalnix">Amaury Sechet</a><em>.</em>
</p>
</div><a name="The-impossible-real-time-thread"></a><div class="idiom"><a class="permalink" href="#The-impossible-real-time-thread">Link
</a><h1 id="the-impossible-real-time-thread">The impossible real-time thread</h1>
<p>It is often said on Internet forums that D couldn't possibly do real-time work, since <em>its stop-the-world GC might pause every thread at once</em>.
</p>
<p><strong>This is wildly inaccurate.</strong> The GC pauses all threads <em>registered to the D runtime</em>.
</p>
<p>Real-time threads like audio callbacks are doable since forever. Here is how:
</p>
<ul>
<li><p>Use a thread that isn't registered. Such a thread could be created by an external library, or with <code class="prettyprint">core.thread.Thread</code> and then unregistered with <a href="http://dlang.org/phobos/core_thread.html#.thread_detachThis"><code class="prettyprint">thread_detachThis()</code></a>. This moves the thread out of <a href="https://github.com/D-Programming-Language/druntime">druntime</a> supervision: it won't be stopped by the GC, and won't be able to use GC allocations.
</p>
</li>
<li><p>Make the thread function or callback <code class="prettyprint">@nogc</code>. This will enforce you don't use the GC.
</p>
</li>
</ul>
<p><strong>Another limitation:</strong> Such a thread must not hold roots to GC objects. What it means is that you <strong>can</strong> use GC objects from the real-time thread, but these GC objects should be pointed to by registered threads to avoid them being collected.
</p>
</div><a name="Eponymous-templates"></a><div class="idiom"><a class="permalink" href="#Eponymous-templates">Link
</a><h1 id="eponymous-templates">Eponymous templates</h1>
<p>The term <strong>eponymous templates</strong> refers to a symbol with the same name as its enclosing <code class="prettyprint">template</code> block.
</p>
<pre class="prettyprint"><code>template HasUniqueElements(int[] arr)
{
    import std.algorithm : sort, uniq;
    import std.array : array;
    enum bool HasUniqueElements = arr.sort().uniq.array.length == arr.length;
}

static assert(HasUniqueElements!( [5, 2, 4] ));
static assert(!HasUniqueElements!( [1, 2, 3, 2] ));
</code></pre><p>In symbol resolution, the template instantiation is replaced by the enclosed declaration with the same name. In a way, this is like <a href="#Extending-a-struct-with-alias-this"><code class="prettyprint">alias this</code></a>, but for templates.
</p>
<p>Bill Baxter came up with the eponymous name in <a href="http://forum.dlang.org/post/gpb2vd$18uf$1@digitalmars.com">this thread</a>.
</p>
</div><a name="Enumerate-fields-with-__traits(allMembers)-and-static-foreach"></a><div class="idiom"><a class="permalink" href="#Enumerate-fields-with-__traits(allMembers)-and-static-foreach">Link
</a><h1 id="enumerate-fields-with-traits-allmembers-and-static-foreach">Enumerate fields with <code class="prettyprint">__traits(allMembers)</code> and "static" <code class="prettyprint">foreach</code></h1>
<p>Using <code class="prettyprint">__traits(allMembers, X)</code> allows us to iterate on the fields of a <code class="prettyprint">struct</code> or <code class="prettyprint">class</code>.
</p>
<p>This can be useful when:
</p>
<ul>
<li>implementing generic serialization/deserialization
</li>
<li>implementing a generic comparison, <code class="prettyprint">.dup</code>, copy, &hellip; for any aggregate
</li>
<li>describing an OpenGL vertex format from the structure
</li>
<li>...
</li>
</ul>
<p>Here's how <a href="https://github.com/D-Programming-Language/dub">DUB</a> implements a <code class="prettyprint">.dup</code> with <code class="prettyprint">__traits(allMembers)</code>:
</p>
<pre class="prettyprint"><code>BuildSettings dup() const
{
    BuildSettings ret;

    // Important: this foreach is a special "static" foreach
    //            though it isn't visually different from a regular foreach
    foreach (m; __traits(allMembers, BuildSettings))
    {
        static if (is(typeof(__traits(getMember, ret, m) = __traits(getMember, this, m).dup)))
            __traits(getMember, ret, m) = __traits(getMember, this, m).dup;
        else static if (is(typeof(__traits(getMember, ret, m) = __traits(getMember, this, m))))
            __traits(getMember, ret, m) = __traits(getMember, this, m);
    }
    return ret;
}
</code></pre><p>When new members are added to BuildSettings, this generic <code class="prettyprint">.dup</code> will still duplicate them.
</p>
</div><a name="Automatic-attribute-inference-for-function-templates"></a><div class="idiom"><a class="permalink" href="#Automatic-attribute-inference-for-function-templates">Link
</a><h1 id="automatic-attribute-inference-for-function-templates">Automatic attribute inference for function templates</h1>
<p>A <code class="prettyprint">pure</code>, <code class="prettyprint">nothrow</code>, <code class="prettyprint">@nogc</code> or <code class="prettyprint">@safe</code> function can only call functions that are respectively <code class="prettyprint">pure</code>, <code class="prettyprint">nothrow</code>, <code class="prettyprint">@nogc</code> or <code class="prettyprint">@safe</code>/<code class="prettyprint">@trusted</code>.
</p>
<pre class="prettyprint"><code>int plusOne(int a)
{
    return a + 1;
}

void f() pure nothrow @nogc @safe
{
    // Error: pure function 'f' cannot call impure function 'plusOne'
    // Error: safe function 'f' cannot call system function 'plusOne'
    // Error: @nogc function 'f' cannot call non-@nogc function 'plusOne'
    // Error: 'plusOne' is not nothrow
    plusOne(3);
}
</code></pre><p><strong>However,</strong> function <em>templates</em> have their attributes automatically inferred.
</p>
<pre class="prettyprint"><code>int plusOne(int b = 2)(int a)
{
    return a + 1;
}

void f() pure nothrow @nogc @safe
{
    plusOne(3); // everything fine
}
</code></pre><h2 id="why"> Why?</h2>
<p>Function templates bodies are always available to the compiler. Which is not the case for non-templated functions, who could be <code class="prettyprint">extern</code>.<br/><strong>For consistency,</strong> non-templated functions attributes don't get inferred, even if the source code is available.
</p>
<p>See also: <a href="https://dlang.org/spec/function.html#function-attribute-inference">https://dlang.org/spec/function.html#function-attribute-inference</a>
</p>
</div><a name="Converting-from-and-to-C-strings"></a><div class="idiom"><a class="permalink" href="#Converting-from-and-to-C-strings">Link
</a><h1 id="converting-from-and-to-c-strings">Converting from and to C strings</h1>
<h2 id="convert-to-c-strings"> Convert to C strings</h2>
<p>Use <code class="prettyprint">std.string.toStringz</code>.
</p>
<pre class="prettyprint"><code>extern(C) nothrow @nogc void log_message(const char* message);

void logMessage(string msg)
{
    import std.string: toStringz;
    log_message(toStringz(msg));
}
</code></pre><p><strong>D string literals are already zero-terminated</strong>, you don't have anything to do in this case.
</p>
<pre class="prettyprint"><code>extern(C) nothrow @nogc void window_set_title(const char* title);

void main()
{
    window_set_title("Welcome to zombo.com");  // Works: literals terminated with '\0'
}

</code></pre><p>See also: <a href="http://dlang.org/phobos/std_string.html#.toStringz">http://dlang.org/phobos/std_string.html#.toStringz</a>
</p>
<h2 id="convert-from-c-strings"> Convert from C strings</h2>
<p>Use <code class="prettyprint">std.string.fromStringz</code>.
</p>
<pre class="prettyprint"><code>extern(C) nothrow @nogc char* window_get_title(window_id id);

struct Window
{
    // Note: to avoid allocations you can return a slice within the C string
    // and keep the slice constant. Else you can use .dup or .idup to get
    // an immutable string.
    const(char)[] name(string msg)
    {
        import std.string: fromStringz;
        return fromStringz( window_get_title(_id) );
    }

    window_id _id;
}
</code></pre><p><strong>What if you already know the length of the C string?</strong>
</p>
<p>Then you can use regular slicing.
</p>
<pre class="prettyprint"><code>assert(len == strlen(messageC));
string messageD = messageC[0..len];
</code></pre><p>See also: <a href="http://dlang.org/phobos/std_string.html#.fromStringz">http://dlang.org/phobos/std_string.html#.fromStringz</a>
</p>
</div><a name="Trailing-commas"></a><div class="idiom"><a class="permalink" href="#Trailing-commas">Link
</a><h1 id="trailing-commas">Trailing commas</h1>
<p>D accepts trailing commas in every comma-separated list of things.
</p>
<pre class="prettyprint"><code>// Function declarations
void doNothing(
        int unusedA,
        int unusedB,
    )
{
}

// enum declarations
enum
{
    whatever,
    yolo,
}

// Array literals
static immutable double[] valuesOfPI =
[
    22.0 / 7.0,
];

void main()
{
    // Function calls
    doNothing(
       0,
       31,
    );

    // AA literals
    string[int] severities =
    [
         0: "info",
         1: "warning",
         2: "error",
    ];
}
</code></pre></div><a name="So-what-does--release-do,-exactly&#63;"></a><div class="idiom"><a class="permalink" href="#So-what-does--release-do,-exactly&#63;">Link
</a><h1 id="so-what-does-release-do-exactly">So what does <code class="prettyprint">-release</code> do, exactly?</h1>
<p>In D compilers, the <code class="prettyprint">-release</code> switch does the following things:
</p>
<ul>
<li>Removing contracts (<code class="prettyprint">in</code> and <code class="prettyprint">out</code> blocks).
</li>
<li>Removing bounds checking in all but <code class="prettyprint">@safe</code> code. That means: <code class="prettyprint">@trusted</code>, <code class="prettyprint">@system</code>, and unmarked functions won't have bounds checks. To overide this behaviour, use the <code class="prettyprint">-boundscheck</code> switch.
</li>
<li>Removing assertions, except <code class="prettyprint">assert(false)</code> which is <a href="#assert(false)-is-special">special</a>.<br/><strong>Failed assertions are considered Undefined Behaviour.</strong> The optimizer can assume that a removed assertion always holds and uses this fact for optimization.
</li>
</ul>
<p>See: <a href="http://dlang.org/dmd-windows.html#switch-release">http://dlang.org/dmd-windows.html#switch-release</a>
</p>
<p><strong>TRIVIA:</strong> Regardless of the use of <code class="prettyprint">-release</code>, assertions are always on whenever the <code class="prettyprint">-unittest</code> flag is passed to the compiler. This is the sort of special case that breathes life in this very page!
</p>
</div><a name="Getting-a-method-callbacked-from-C"></a><div class="idiom"><a class="permalink" href="#Getting-a-method-callbacked-from-C">Link
</a><h1 id="getting-a-method-callbacked-from-c">Getting a method callbacked from C</h1>
<p><strong>How to get a class method callbacked from C?</strong>
</p>
<p>What is needed is a way to pass the <code class="prettyprint">this</code> pointer. Most C callbacks allow to specify a "user data" pointer.<br/>A common trick is to cast <code class="prettyprint">this</code> into a <code class="prettyprint">void*</code> pointer back and forth, and use it as user data.
</p>
<p>Here is an example with SDL2 logging handler:
</p>
<pre class="prettyprint"><code>class MyGame
{
    this()
    {
        // Pass this as user data, since most C callbacks have one.
        SDL_LogSetOutputFunction(&amp;loggingCallbackSDL, cast(void*)this);
    }

    // We'd like this method to get called whenever the SDL callback triggers
    void onMessage(const(char)* message)
    {
        // do stuff
    }
}

extern(C)  // would be extern(System) depending on the library
void loggingCallbackSDL(void* userData, int category, SDL_LogPriority priority, const(char)* message)
{
    // Get back the object reference here
    MyGame game = cast(MyGame)userData;
    game.onMessage(message);
}
</code></pre></div><a name="Design-by-Introspection"></a><div class="idiom"><a class="permalink" href="#Design-by-Introspection">Link
</a><h1 id="design-by-introspection">Design by Introspection</h1>
<h2 id="what-is-design-by-introspection"> What is Design by Introspection?</h2>
<p>Coined and promoted by Andrei Alexandrescu, <strong>Design by Introspection</strong> (also known as "DbI") means something pretty specific: instead of multiplying the number of named concepts in generic code, let's <strong>inspect types at compile-time for capabilities</strong>.
</p>
<p>An example is Phobos' input ranges that can be <a href="http://dlang.org/phobos/std_range_primitives.html#.isInfinite">infinite</a> regardless of the particular compile-time concept they follow.
</p>
<p>In the D language, such duck-typing at compile-time seems to unlock most interesting designs.
</p>
<h2 id="code-examples"> Code examples</h2>
<ul>
<li><p><code class="prettyprint">std.range.primitives</code>: <a href="http://dlang.org/phobos/std_range_primitives.html">http://dlang.org/phobos/std<em>range</em>primitives.html</a>
</p>
</li>
<li><p><code class="prettyprint">std.experimental.allocator</code>: <a href="http://dlang.org/phobos/std_experimental_allocator.html">http://dlang.org/phobos/std<em>experimental</em>allocator.html</a>
</p>
</li>
</ul>
<h2 id="where-do-i-start"> Where do I start?</h2>
<p>There is currently not much written on this programming technique.
</p>
<p>The best resource on the topic is probably this talk by Alexandrescu: <a href="https://www.youtube.com/watch?v=LIb3L4vKZ7U">std::allocator Is to Allocation what std::vector is to Vexation</a>.
</p>
</div><a name="Using-std.typecons.Flag-like-a-pro"></a><div class="idiom"><a class="permalink" href="#Using-std.typecons.Flag-like-a-pro">Link
</a><h1 id="using-std-typecons-flag-like-a-pro">Using <code class="prettyprint">std.typecons.Flag</code> like a pro</h1>
<p>Functions calls with boolean arguments are often hard to read and don't provide meaning.
</p>
<pre class="prettyprint"><code>void doSomething(bool frob);

[...]

doSomething(false);         // false what?
</code></pre><p>Fortunately <code class="prettyprint">std.typecons.Flag</code> can help you turn <code class="prettyprint">bool</code> arguments into readable flags at no cost.<br/>Buy it now! At your local standard library dealer.
</p>
<pre class="prettyprint"><code>import std.typecons;

void doSomething(Flag!"frob" frob);

[...]

doSomething(No.frob);       // ok, no frob. Got it
</code></pre><h2 id="here-are-the-guidelines-straight-from-andrei-alexandrescu"> Here are the guidelines straight from Andrei Alexandrescu:</h2>
<ul>
<li><p>Use the name <code class="prettyprint">Flag!"frob"</code> for the type of the flag
</p>
</li>
<li><p>Use <code class="prettyprint">Yes.frob</code> and <code class="prettyprint">No.frob</code> for the flag values
</p>
</li>
<li><p><strong>Do not alias</strong> <code class="prettyprint">Flag!"frob"</code> <strong>to a new name.</strong>
</p>
</li>
</ul>
<p>For more documentation: <a href="https://dlang.org/phobos/std_typecons.html#.Flag">https://dlang.org/phobos/std_typecons.html#.Flag</a>
</p>
</div><a name="String-interpolation-as-a-library"></a><div class="idiom"><a class="permalink" href="#String-interpolation-as-a-library">Link
</a><h1 id="string-interpolation-as-a-library">String interpolation as a library</h1>
<p>D doesn't have <a href="https://en.wikipedia.org/wiki/String_interpolation">string interpolation</a> built in the language like PHP, Perl or Python.<br/>Yet you can get a similar feature using the <code class="prettyprint">scriptlike</code> library from Nick Sabalausky.
</p>
<pre class="prettyprint"><code>import scriptlike;
int num = 21;
writeln( mixin(interp!"The number ${num} doubled is ${num * 2}.") ); // Output: The number 21 doubled is 42.
</code></pre><h2 id="is-interp-difficult-to-implement"> Is <code class="prettyprint">interp</code> difficult to implement?</h2>
<p>It turns out <code class="prettyprint">interp</code> is a <a href="https://github.com/Abscissa/scriptlike/blob/4350eb745531720764861c82e0c4e689861bb17e/src/scriptlike/core.d#L114">pretty simple function</a>, forced to execute at compile-time through CTFE by the use of <code class="prettyprint">mixin</code>.
</p>
<p><code class="prettyprint">scriptlike</code> also provides many more useful features for quick programs.<br/>Homepage: <a href="https://github.com/Abscissa/scriptlike">https://github.com/Abscissa/scriptlike</a>
</p>
</div><a name="assert(false)-is-special"></a><div class="idiom"><a class="permalink" href="#assert(false)-is-special">Link
</a><h1 id="assert-false-is-special"><code class="prettyprint">assert(false)</code> is special</h1>
<p><code class="prettyprint">assert(false)</code>, <code class="prettyprint">assert(0)</code>, <code class="prettyprint">assert(null)</code>, or any other falsey expression at compile-time does not produce a regular <code class="prettyprint">assert</code>.
</p>
<p>Instead it is an instruction to crash the program, and is <strong>not</strong> removed in <code class="prettyprint">-release</code> mode.
</p>
<pre class="prettyprint"><code>string getStuff()
{
    if(expr)
        return "something";
    assert(1 &lt; 0); // also possible, but "assert(0)" is typically used
    // no return needed, since we just crashed
}
</code></pre><p><code class="prettyprint">assert(false)</code> (or an equivalent) also means that the current branch of the function doesn't need to return anything since the program will always crash when the assertion is reached.
</p>
<p><strong>It does not mean </strong> <em>unreachable code</em><strong>, it means </strong> <em>crash now</em> <strong> and the compiler will never remove it.</strong>
</p>
<h2 id="always-on-assertion"> Always-on assertion</h2>
<p>Since <code class="prettyprint">assert(false)</code> never get removed, it can be used to create a persistent assertion.
</p>
<pre class="prettyprint"><code>    if (!cond)
        assert(false); // will never be removed by the compiler in -release builds

</code></pre><p><code class="prettyprint">assert(false)</code> is fit for finding bugs, <a href="#Unrecoverable-vs-recoverable-errors">but not for input errors</a>. In this case, prefer the use of <code class="prettyprint">std.exception.enforce</code>.
</p>
<p>See: <a href="http://dlang.org/phobos/std_exception.html#.enforce">http://dlang.org/phobos/std_exception.html#.enforce</a>
</p>
</div><a name="Is-a-specific-program-available-in-PATH&#63;"></a><div class="idiom"><a class="permalink" href="#Is-a-specific-program-available-in-PATH&#63;">Link
</a><h1 id="is-a-specific-program-available-in-path">Is a specific program available in PATH?</h1>
<p>This functions checks the <code class="prettyprint">PATH</code> environment variable, looking for a specific program.
</p>
<pre class="prettyprint"><code>// Similar to unix tool "which", that shows the full path of an executable
string which(string executableName)
{
    import std.process: environment;
    import std.path: pathSeparator, buildPath;
    import std.file: exists;
    import std.algorithm: splitter;

    // pathSeparator: Windows uses ";" separator, POSIX uses ":"
    foreach (dir; splitter(environment["PATH"], pathSeparator))
    {
        auto path = buildPath(dir, executableName);
        if (exists(path))
            return path;
    }
    throw Exception("Couldn't find " ~ executableName);
}
</code></pre><p>If the command isn't available, this function will throw an <code class="prettyprint">Exception</code>.
</p>
<pre class="prettyprint"><code>which("wget").writeln; // output: /usr/bin/wget
</code></pre></div><a name="Knowing-inout-inside-out"></a><div class="idiom"><a class="permalink" href="#Knowing-inout-inside-out">Link
</a><h1 id="knowing-inout-inside-out">Knowing <code class="prettyprint">inout</code> inside out</h1>
<p><code class="prettyprint">inout</code> <strong>is a good-looking storage class. When should it be used?</strong>
</p>
<h2 id="firstly-inout-is-great-for-writing-getters-returning-references"> Firstly, <code class="prettyprint">inout</code> is great for <strong>writing getters returning references</strong>.</h2>
<pre class="prettyprint"><code>struct MyBuffer(T)
{
    private T* data;

    // This getter needs inout to fit MyBuffer,
    // const(MyBuffer) or immutable(MyBuffer) as caller
    inout(T)* getData() inout // &lt;= 2nd inout applies to "this"
    {
        return data;
    }
}
</code></pre><p>It avoids to write the longer equivalent:
</p>
<pre class="prettyprint"><code>// Longer struct without inout
struct MyBuffer(T)
{
    private T* data;

    T* getData()
    {
        return data;
    }

    const(T)* getData() const
    {
        return data;
    }

    immutable(T)* getData() immutable
    {
        return data;
    }
}
</code></pre><h2 id="secondly-inout-is-also-useful-for-free-functions-walking-reference-types"> Secondly, <code class="prettyprint">inout</code> is also useful for free functions walking reference types:</h2>
<pre class="prettyprint"><code>// An example of a useful free function using inout
inout(char)[] chomp(inout(char)[] str)
{
    if (str.length &amp;&amp; str[$-1] == '\n')
        return str[0..$-1];
    else
        return str;
}
</code></pre><h2 id="it-is-allowed-to-use-inout-variables-inside-of-an-inout-enabled-function"> It is allowed to use <code class="prettyprint">inout</code> variables inside of an <code class="prettyprint">inout</code>-enabled function:</h2>
<pre class="prettyprint"><code>// Useless example to demonstrate inout local variables
inout(int)[] lastItems(inout(int)[] arr, size_t pivot)
{
    // Local inout variables are allowed
    inout(int)[] lasts = arr[nth+1..$];
    return lasts;
}
</code></pre><p>But <code class="prettyprint">inout</code> member variables are <strong>not</strong> allowed, because <code class="prettyprint">inout</code> doesn't mean anything outside the context of a function.
</p>
<pre class="prettyprint"><code>struct InoutMember
{
    inout(int) member; // Wrong, won't compile
}
</code></pre></div><a name="Never-use-&gt;=-for-dependencies"></a><div class="idiom"><a class="permalink" href="#Never-use-&gt;=-for-dependencies">Link
</a><h1 id="never-use-for-dependencies">Never use &gt;= for dependencies</h1>
<p>Using DUB and dependencies? Here is a pattern you should avoid:
</p>
<pre class="prettyprint"><code>{
    "name": "my-program",

    "dependencies":
    {
        "awesome-lib": "&gt;=1.0.0"
    }
}


</code></pre><p>Depending on a library using <code class="prettyprint">&gt;=</code> is risky. If <code class="prettyprint">awesome-lib</code> breaks its API then releases a new major tag, your project will break. This is implicit in SemVer and using <code class="prettyprint">&gt;=</code> suscribes for immediate breakage.
</p>
<p>Now this can be useful for executables, but this is especially bad for publicly released libraries. Any downstream project might break in the future when using your already released tags. And <em>how will you fix tags that are already in use?</em>
</p>
<p><strong>TL;DR Do not depend on APIs that will break in the future. Use</strong> <code class="prettyprint">~&gt;</code> <strong>or</strong> <code class="prettyprint">==</code> <strong>instead.</strong>
</p>
<p>See: <a href="http://code.dlang.org/package-format#version-specs">http://code.dlang.org/package-format#version-specs</a>
</p>
</div><a name="Throwing-despite-@nogc"></a><div class="idiom"><a class="permalink" href="#Throwing-despite-@nogc">Link
</a><h1 id="throwing-despite-nogc">Throwing despite <code class="prettyprint">@nogc</code></h1>
<p> <strong>This trick is a dirty Proof Of Concept. Just never do it.</strong>
</p>
<p>The major limitation of <code class="prettyprint">@nogc</code> is that you can't throw exceptions allocated with <code class="prettyprint">new</code>.
</p>
<p>But if you really want it, exceptions can be pre-allocated to be thrown later:
</p>
<pre class="prettyprint"><code>// Statically initialize an exception instance.
static immutable Exception g_Exception = new Exception("This message won't be helpful");

// Function that throws despite being @nogc
void nogcFunction() @nogc
{
    throw g_Exception;
}

try
{
    nogcFunction();
}
catch(const(Exception) e)
{
    // Message, file and line number won't be given though
    import std.stdio;
    writefln("Received an exception: %s", e.msg);
}
</code></pre><p>Such a pre-allocated exception won't hold any information other than <em>"something went wrong"</em>. And it breaks the type system badly.
</p>
<p>Note from <a href="https://github.com/JakobOvrum">Jakob Ovrum</a>:
</p>
<pre class="prettyprint"><code>I really don't think you should promote that hack anywhere.
Even the druntime internal exception code will mutate it post-allocation regardless of mutability.
The compiler is even allowed to put the exception in ROM which would of course break everything.
You can also throw a mutable exception and catch it as immutable(Exception),
the whole thing is completely unintegrated with D2's type system.
Again, it doesn't matter if you catch it or not because the unwinding code will mutate it.
It's just straight up bad code.
</code></pre></div><a name="What-is-the-difference-between-out-and-ref-parameters&#x3F"></a><div class="idiom"><a class="permalink" href="#What-is-the-difference-between-out-and-ref-parameters&#x3F">Link
</a><h1 id="what-is-the-difference-between-out-and-ref-parameters">What is the difference between <code class="prettyprint">out</code> and <code class="prettyprint">ref</code> parameters?</h1>
<p>Both pass parameters by reference. But <code class="prettyprint">out</code> parameters are initialized with <code class="prettyprint">.init</code> at function startup, while <code class="prettyprint">ref</code> parameters aren't.
</p>
<pre class="prettyprint"><code>import std.stdio;
import std.math;

void functionUsingRef(ref float refParam)
{
    writeln(refParam);
}

void functionUsingOut(out float outParam)
in
{
    // Initialization for out parameters happens
    // before function pre-conditions.
    assert(isNaN(outParam));
}
body
{
    writeln(outParam);
    // Nothing actually forces you to write outParam
    // but that's what you should normally do.
    // You can also read it's value.
}

void main()
{
    float x = 2.5f;
    functionUsingRef(x); // Output: 2.5
    functionUsingOut(x); // Output: nan
    writeln(x);          // Output: nan
}

</code></pre><p><code class="prettyprint">ref</code> and <code class="prettyprint">out</code> are <strong>storage classes</strong>, not <strong>type qualifiers</strong>. They don't belong to the parameter's type.
</p>
</div><a name="How-does-D-improve-on-C++17&#63;"></a><div class="idiom"><a class="permalink" href="#How-does-D-improve-on-C++17&#63;">Link
</a><h1 id="how-does-d-improve-on-c-17">How does D improve on C++17?</h1>
<p><strong>Warning: this post is opinionated.</strong>
</p>
<p>&nbsp;
</p>
<p>With C++ evolving and coming to C++17, <strong>is D still relevant?</strong>
</p>
<p>I think that yes, and very much so. Here's is why.
</p>
<h2 id="dub"> DUB</h2>
<p>D has a package manager. C++ has none that is popular in its community.<br/>Using a <a href="http://code.dlang.org/">third-party library</a> becomes many times easier.
</p>
<h2 id="no-more-preprocessor"> No more preprocessor</h2>
<p>D has no need for a preprocessor.
</p>
<h2 id="no-more-header-files-today"> No more header files, today</h2>
<p>Even when C++ compilers implement modules and you can finally use them, headers will still survive alongside modules for backward compatibility.
</p>
<h2 id="no-more-order-of-declaration"> No more order of declaration</h2>
<p>Order of declaration is insignificant in D. There is no need to pre-declare or reorder anything.
</p>
<h2 id="faster-compiles"> Faster compiles</h2>
<p>C++ has <a href="http://www.drdobbs.com/cpp/c-compilation-speed/228701711">compilation speed problems</a>. For example the preprocessor needs to iterate on source files at least 3 times by design.
</p>
<p>In C++ development, significant amounts of time can be spent waiting for the compiler.
</p>
<h2 id="default-initialization"> Default initialization</h2>
<p>Uninitialized variables can create subtle and hard to find bugs in C++ programs. In D all variables and members are initialized by default. If that happens to be expensive, the <code class="prettyprint">= void</code> initialization can be used instead.
</p>
<h2 id="name-conflict-bugs-are-impossible"> Name conflict bugs are impossible</h2>
<p>A name conflict when importing modules with the same identifier triggers a compilation error. It is thus impossible to use the wrong symbol by mistake.
</p>
<h2 id="no-more-implicit-conversion-of-arrays-to-pointers"> No more implicit conversion of arrays to pointers</h2>
<p>This is a long-standing problem with C and C++.
</p>
<h2 id="ranges-vs-iterators"> Ranges vs Iterators</h2>
<p>Ranges provides a number of <a href="http://accu.org/content/conf2009/AndreiAlexandrescu_iterators-must-go.pdf">advantages</a> over iterators, being essentially a better tool for iteration.
</p>
<h2 id="move-and-copy-semantics-radically-simplified"> Move and copy semantics radically simplified</h2>
<p>D makes the assumption that structs and classes are copyable by bit copy. It adds some restrictions on internal pointers, but overall it's simpler.
</p>
<h2 id="unittest-blocks"> <code class="prettyprint">unittest</code> blocks</h2>
<p>Built-in unit-tests lower the barrier for testing.
</p>
<h2 id="documentation-comments"> Documentation comments</h2>
<p>Similarly built-in documentation comments lower the barrier for writing documentation comments.
</p>
<h2 id="the-d-stl-is-actually-readable"> The D STL is actually readable</h2>
<p>Reading Phobos source code is easy and often enlightening.
</p>
<h2 id="simpler-object-model"> Simpler object model</h2>
<p>C++ having multiple inheritance implies a <a href="http://www.amazon.fr/Inside-Object-Model-Stanley-Lippman/dp/0201834545">complex object model</a>.<br/>With <code class="prettyprint">alias this</code>, multiple implementation inheritance is pretty much never needed.
</p>
<h2 id="streamlined-operator-overloading"> Streamlined operator overloading</h2>
<p>Making custom numerical types requires a lot less operator overloads.
</p>
<h2 id="pre-and-post-increment-have-been-fixed"> ++pre and post-increment++ have been fixed</h2>
<p>See how <a href="#Should-I-use-++pre-increment-or-post-increment++?">here</a>.
</p>
<h2 id="gc"> GC</h2>
<p>For the large majority of programs, the GC is a productivity enhancer. For the other programs, it's <a href="#How-the-D-Garbage-Collector-works">not that bad</a> and can be work-arounded.
</p>
<h2 id="no-need-for-c-templates-heroes"> No need for C++ templates heroes</h2>
<p>The easier and more powerful templates of D allow <em>any</em>  programmer to create meta-programs routinely. Not just one programmer in your team which happen to be comfortable with them.
</p>
<h2 id="large-language-but-approachable"> Large language, but approachable</h2>
<p>Learning to use D well is tricky, but you can use a subset from the get-go.
</p>
<p>&nbsp;
</p>
<h2 id="downsides"> Downsides</h2>
<p>For balance, here are the downsides <strong>(opinionated again)</strong>:
</p>
<ul>
<li>D has a smaller (growing) community.
</li>
<li>C++ has nice, composable RAII. D has a more complicated <a href="#The-trouble-with-class-destructors">story</a> with resources.
</li>
<li>D is easy to start using but not that easy to use really well. Hence, this website.
</li>
<li>Not every purpose is compatible with a GC.
</li>
</ul>
</div><a name="Friends-don't-let-friends-use-the-default-struct-postblit"></a><div class="idiom"><a class="permalink" href="#Friends-don't-let-friends-use-the-default-struct-postblit">Link
</a><h1 id="friends-don-t-let-friends-use-the-default-struct-postblit">Friends don't let friends use the default struct postblit</h1>
<p>By default D structs are copyable and that copy is just a <code class="prettyprint">.dup</code> verbatim bit copy.<br/>Indeed the default struct <a href="http://dlang.org/struct.html">postblit</a> does nothing.
</p>
<pre class="prettyprint"><code>struct MyStruct
{
    int field;
}

MyStruct a;
MyStruct b;

a = b; // Bit copy here.
</code></pre><p>The trouble happens with structs that hold a resource: whenever copied, the struct destructor would be called twice, and twice the resource would be freed.
</p>
<p>That doesn't look like the beginning of a success story. To solve this, follow the Rule of Two.
</p>
<h2 id="rule-of-two"> Rule of Two</h2>
<p><strong>If a struct has a non-trivial destructor, then:</strong><br/><strong>- either disable the default postblit with</strong> <code class="prettyprint">@disable this(this)</code>,<br/><strong>- or implement the postblit.</strong><br/><strong>Don't let the default one.</strong>
</p>
<h2 id="example"> Example</h2>
<pre class="prettyprint"><code>struct MyResource
{
    this()
    {
        acquireResource();
    }

    ~this()
    {
        releaseResource();
    }

    // Disabling the postblit to avoid the destructor being
    // called twice after an accidental copy.
    @disable this(this);

    /*
        // Alternatively, duplicate the resource
        this(this)
        {
            duplicateResource();
        }
    */
}

</code></pre><p>See: <a href="http://dlang.org/struct.html">http://dlang.org/struct.html</a>
</p>
</div><a name="Falsey-values"></a><div class="idiom"><a class="permalink" href="#Falsey-values">Link
</a><h1 id="falsey-values">Falsey values</h1>
<p>In an <code class="prettyprint">if(expr)</code> condition, <code class="prettyprint">expr</code> does not need to have boolean type.
</p>
<p>Falsey value in D are:
</p>
<ul>
<li>the integer 0
</li>
<li>the floating point values +0.0 and -0.0 (NaNs and infinities are truthy)
</li>
<li>the <code class="prettyprint">null</code> pointer / <code class="prettyprint">null</code> delegate / <code class="prettyprint">null</code> class reference
</li>
<li>the boolean <code class="prettyprint">false</code>
</li>
<li>enum members equal to 0
</li>
<li>slices with a null <code class="prettyprint">.ptr</code> data pointer (length of slice is irrelevant)
</li>
</ul>
<p>Thus, the empty string <code class="prettyprint">""</code> points to a single <code class="prettyprint">\0</code> char (string literals are zero-terminated for C compatibility reasons), and is <strong>truthy</strong> despite having length 0.
</p>
<pre class="prettyprint"><code>
ubyte* p = cast(ubyte*)("".ptr);
assert(p != null);
assert(*p == 0);

</code></pre><p><a href="http://minas-mina.com/2015/11/17/if-statement/">See this article for more...</a>
</p>
</div><a name="Extend-a-struct-with-alias-this"></a><div class="idiom"><a class="permalink" href="#Extend-a-struct-with-alias-this">Link
</a><h1 id="extend-a-struct-with-alias-this">Extend a struct with <code class="prettyprint">alias this</code></h1>
<p>What if we want to decorate a struct with additional features?<br/>We can't use virtual dispatch since the parent aggregate is a <code class="prettyprint">struct</code>.<br/>That means we are on board for extensive manual delegation of method calls to a member.
</p>
<p>Fortunately the <code class="prettyprint">alias this</code> feature comes to the rescue!
</p>
<p>As an example, let's write a wrapper around the Phobos <code class="prettyprint">File</code> struct for writing an HTML page.
</p>
<pre class="prettyprint"><code>import std.stdio;
import std.file;
struct HTMLPage
{
    File file;
    alias file this; // file's methods are looked at on name lookup.
    this(string path)
    {
        file = File(path, "w"); // akin to calling parent constructor
    }
    void writeAnchor(string anchor)
    {
        writeln("&lt;" ~ anchor ~ "&gt;"); // will call file.writeln
    }
}
</code></pre><p>When using <code class="prettyprint">HTMLPage</code> you will still have access to every method in <code class="prettyprint">File</code>. For example, you'll be able to do:
</p>
<pre class="prettyprint"><code>htmlPage.writeln("&lt;doctype html&gt;");
</code></pre><p>This site uses this idiom.
</p>
<p><code class="prettyprint">alias this</code> can also define an implicit conversion.
</p>
<pre class="prettyprint"><code>struct A
{
    int a;
}
struct B
{
    A a;
    alias a this;
    string b;
}
int f(A a)
{
    return a.a+1;
}
int g(ref A a)
{
    return a.a+1;
}
ref A h(ref A a)
{
    return a;
}
void main(string[]ags)
{
    B b;
    return f(b)  // b implicitely converted to an A
         + g(b); // b implicitely converted to a ref A
}
</code></pre><p>As <a href="http://www.amazon.fr/The-Programming-Language-Andrei-Alexandrescu/dp/0321635361">TDPL</a> says it, using <code class="prettyprint">alias this</code> is subtyping.
</p>
</div><a name="Embed-a-dynamic-library-in-an-executable"></a><div class="idiom"><a class="permalink" href="#Embed-a-dynamic-library-in-an-executable">Link
</a><h1 id="embed-a-dynamic-library-in-an-executable">Embed a dynamic library in an executable</h1>
<p>Let's say we want to distribute a standalone executable that doesn't need any installation.<br/>Here we'll see how to embed SDL.dll into an executable.
</p>
<pre class="prettyprint"><code>import std.uuid;
import std.file;
import std.path;
import std.string;

ubyte[] sdlBytes = cast(ubyte[]) import("SDL2.dll");   // SDL2.dll contents

void main(string[] args)
{
    string uuid = randomUUID().toString();
    string filename = format("SDL2-%s.dll", uuid);     // Making an unique file name.
    string depacked = buildPath(tempDir(), filename);
    
    std.file.write(depacked, sdlBytes);                // Writing the library to a temporary file.
    
    DerelictSDL2.load(depacked);                       // Use the depacked library and load its symbols.
}
</code></pre><p>A similar trick can be used for embedding fonts, images, etc. without having to deal with a resource compiler.
</p>
</div><a name="Custom-format()-for-builtin-types"></a><div class="idiom"><a class="permalink" href="#Custom-format()-for-builtin-types">Link
</a><h1 id="custom-format-for-builtin-types">Custom <code class="prettyprint">format()</code> for builtin types</h1>
<p>When using <code class="prettyprint">std.conv.to()</code> or <code class="prettyprint">std.stdio.write()</code>, the arguments are formatted using a predefined format.
</p>
<p>Structs are processed differently. By default, all the members of a <code class="prettyprint">struct</code> are converted<br/>but the internal <code class="prettyprint">to()</code> also checks if a <code class="prettyprint">struct</code> implements a custom <code class="prettyprint">toString()</code> function.<br/>If so, this function is used and the default formatting of the members doesn't happen.
</p>
<p>This can be used as a trick to override the default predefined formats of a basic type.
</p>
<p>For example, to display a pointer as a hexadecimal address prefixed with <code class="prettyprint">0x</code>, we can define a <code class="prettyprint">struct</code> with a single member of type <code class="prettyprint">void*</code> and a custom <code class="prettyprint">toString()</code> function:
</p>
<pre class="prettyprint"><code>import std.stdio;

struct FmtPtr
{
    void* ptr;
    string toString()
    {
        import std.format;
        static if (size_t.sizeof == 4)
            return format("0x%.8X ", cast(size_t)ptr);
        static if (size_t.sizeof == 8)
            return format("0x%.16X ", cast(size_t)ptr);
    }
}

void main(string[] args)
{
    import core.stdc.stdlib;
    auto a = malloc(8);
    auto b = malloc(8);
    auto c = malloc(8);

    // ugly custom formatting
    writeln("0X", a, " ", "0X", b, " ", "0X", c);
    writefln("0X%.8X 0X%.8X 0X%.8X", a, b, c);

    // clean and clear equivalent using the struct
    writeln(FmtPtr(a), FmtPtr(b), FmtPtr(c));
}
</code></pre></div><a name="Bypassing-@nogc"></a><div class="idiom"><a class="permalink" href="#Bypassing-@nogc">Link
</a><h1 id="bypassing-nogc">Bypassing @nogc</h1>
<p><code class="prettyprint">@nogc</code> is a function attribute which ensures a function never allocates through the GC.
</p>
<pre class="prettyprint"><code>void processStuff(double[] data) @nogc
{
    double[] tempBuffer;

    // Error: setting 'length' in @nogc function processStuff may cause GC a
    tempBuffer.length = data.length; 

    ...
}
</code></pre><p>Using <code class="prettyprint">@nogc</code> is a must for memory-conscious code sections or for real-time threads.
</p>
<p>However, not all library functions that could be marked <code class="prettyprint">@nogc</code> are. At one point, you'll probably want to call functions as if they were <code class="prettyprint">@nogc</code>. Here's how to do it:
</p>
<pre class="prettyprint"><code>import std.traits;

// Casts @nogc out of a function or delegate type.
auto assumeNoGC(T) (T t) if (isFunctionPointer!T || isDelegate!T)
{
    enum attrs = functionAttributes!T | FunctionAttribute.nogc;
    return cast(SetFunctionAttributes!(T, functionLinkage!T, attrs)) t;
}

// This function can't be marked @nogc but you know with application knowledge it won't use the GC.
void funcThatMightUseGC(int timeout)
{
    if (unlikelyCondition(timeout))
        throw new Exception("The world actually imploded.");

    doMoreStuff();
}

void funcThatCantAffortGC() @nogc
{
    // using a casted delegate literal to call non-@nogc code
    assumeNoGC( (int timeout)
                {
                    funcThatMightUseGC(timeout);
                })(10000);
}
</code></pre></div><a name="Minimum-or-maximum-of-numbers"></a><div class="idiom"><a class="permalink" href="#Minimum-or-maximum-of-numbers">Link
</a><h1 id="minimum-or-maximum-of-numbers">Minimum or maximum of numbers</h1>
<p><code class="prettyprint">min</code> and <code class="prettyprint">max</code> are found in <code class="prettyprint">std.algorithm</code>, not <code class="prettyprint">std.math</code>.
</p>
<pre class="prettyprint"><code>import std.algorithm : max;
int a = -5;
int b = 4;
double c = 10.0;
double max_abc = max(a, b, c);
assert(max_abc == 10.0);
</code></pre><p>They work with builtin types and any number of arguments.
</p>
<p>See: <a href="http://dlang.org/phobos/std_algorithm.html#.min">http://dlang.org/phobos/std_algorithm.html#.min</a>
</p>
<h2 id="minimum-or-maximum-of-a-slice"> Minimum or maximum of a slice</h2>
<p>There is no standard function to get the minimum and maximum element of a slice.<br/>But you can use <code class="prettyprint">std.algorithm.reduce()</code>.
</p>
<pre class="prettyprint"><code>import std.algorithm : min, max, reduce;

double[] slice = [3.0, 4.0, -2.0];

double minimum = reduce!min(slice);
double maximum = reduce!max(slice);

assert(minimum == -2.0);
assert(maximum == 4.0);
</code></pre></div><a name="Precise-timestamps-in-milliseconds"></a><div class="idiom"><a class="permalink" href="#Precise-timestamps-in-milliseconds">Link
</a><h1 id="precise-timestamps-in-milliseconds">Precise timestamps in milliseconds</h1>
<p><code class="prettyprint">core.time.MonoTime.currTime()</code> returns the most precise (as opposed to <em>accurate</em>) available clock.
</p>
<pre class="prettyprint"><code>/// Returns: Most precise clock ticks, in milliseconds.
long getTickMs() nothrow @nogc
{
    import core.time;
    return convClockFreq(MonoTime.currTime.ticks, MonoTime.ticksPerSecond, 1_000);
}

</code></pre></div><a name="How-the-D-Garbage-Collector-works"></a><div class="idiom"><a class="permalink" href="#How-the-D-Garbage-Collector-works">Link
</a><h1 id="how-the-d-garbage-collector-works">How the D Garbage Collector works</h1>
<p>There seems to be a stigma surrounding Garbage Collection when you talk to C++ users. The GC would be an wild memory-hungry beast that can't be tamed, essentially outside the control of the programmer. It would render real-time work <a href="#The-impossible-real-time-thread">impossible</a> by its mere presence.
</p>
<p>But the D Garbage Collector is firmly under the application control. Once you learn how it works, it doesn't seem so uncontrollable, and reveal itself as what it really is: a <a href="http://dlang.org/garbage.html">trade-off</a> that most modern languages have choosen.
</p>
<h2 id="how-the-d-gc-works"> How the D GC works:</h2>
<p>First of all, collections are <strong>not triggered randomly</strong> but when a thread allocates memory.
</p>
<ul>
<li>A thread tries to allocate memory. At this point the GC may decide to collect garbage. If so, the current thread is <em>hijacked</em> for GC work.
</li>
<li>Memory ranges, starting from <em>roots</em>, are scanned recursively looking for more pointers into GC-owned memory. Each memory regions use markers to avoid scanning the same block of memory multiple times. <strong>This step can be slow.</strong> The GC features optimizations to speed-up scanning: heap areas are labelled with types, only areas with pointers are scanned, and pointer to GC memory have <a href="http://dlang.org/garbage.html">restrictions</a>.
</li>
<li>GC allocated memory that has no active pointers to it and do not need destructors to run is freed.
</li>
<li>Conversely, all unreachable memory that needs destructors to run is queued.
</li>
<li>All threads are resumed. The GC pause is then finished.
</li>
<li>Destructors for all queued memory are run. Unfortunately there is <a href="#The-trouble-with-class-destructors">caveats</a> associated with the GC thread calling destructors.
</li>
<li>Remaining unreachable memory is freed.
</li>
<li>The current thread returns to whatever work it was doing.
</li>
</ul>
<h2 id="tips"> Tips</h2>
<p>Intuitively, one can see that memory scanning is a potentially long and expensive process. Keeping a small GC heap makes it faster.<br/>What you can do to accelerate scanning is using <code class="prettyprint">malloc</code>/<code class="prettyprint">free</code> instead of <code class="prettyprint">new</code> to allocate big chunks of memory.<br/>Anything that reduces the total amount of GC-owned memory will reduce the maximum pause duration.
</p>
<h2 id="more-about-the-gc"> More about the GC</h2>
<p>See: <a href="http://dlang.org/garbage.html">http://dlang.org/garbage.html</a>.
</p>
</div><a name="D-online-resources"></a><div class="idiom"><a class="permalink" href="#D-online-resources">Link
</a><h1 id="d-online-resources">D online resources</h1>
<ul>
<li><a href="https://github.com/zhaopuming/awesome-d">Awesome D</a> - A curated list of awesome D documents, frameworks, libraries and software.
</li>
<li><a href="http://wiki.dlang.org/Books">List of available D books</a>
</li>
<li><a href="http://rosettacode.org/wiki/Category:D">D page on rosettacode.org</a>
</li>
<li><a href="http://dlang.org/phobos/index.html">Phobos documentation</a>
</li>
<li><a href="http://wiki.dlang.org/">The D wiki</a>
</li>
<li><a href="http://forum.dlang.org/">D newsgroup</a>
</li>
<li><a href="http://code.dlang.org/">DUB registry</a>
</li>
<li><a href="http://qznc.github.io/d-tut/index.html">Pragmatic D Tutorial</a>
</li>
<li><a href="https://github.com/PhilippeSigaud/D-templates-tutorial/raw/master/D-templates-tutorial.pdf">D template tutorial by Philippe Sigaud</a>
</li>
</ul>
</div><a name="Smallest-dub.json-for-an-executable"></a><div class="idiom"><a class="permalink" href="#Smallest-dub.json-for-an-executable">Link
</a><h1 id="smallest-dub-json-for-an-executable">Smallest dub.json for an executable</h1>
<p>What DUB options are strictly necessary in a <code class="prettyprint">dub.json</code> file to build an executable?
</p>
<p>It turns out only one is needed:
</p>
<pre class="prettyprint"><code>{
    "name": "program_name"
}
</code></pre><p>Place the source code in a <code class="prettyprint">source/main.d</code> or <code class="prettyprint">source/app.d</code> file and DUB will find it and guess<br/>you want to build an executable.
</p>
<p>No <code class="prettyprint">main.d</code> or <code class="prettyprint">app.d</code>? DUB will guess it's a source library then.
</p>
</div><a name="Capturing-with-regular-expressions"></a><div class="idiom"><a class="permalink" href="#Capturing-with-regular-expressions">Link
</a><h1 id="capturing-with-regular-expressions">Capturing with regular expressions</h1>
<p>Regular expressions are found in the <code class="prettyprint">std.regex</code> Phobos module.
</p>
<pre class="prettyprint"><code>import std.regex;
import std.stdio;

void main(string[] args)
{
    auto re = regex(`My name is (\w+)\. I work for ([A-Za-z ]+)\.`);

    string input = "My name is Kobayashi. I work for Keyser Soze.";

    if (auto captures = matchFirst(input, re))
    {
        // There is a trap there, capture[0] is the whole matched string
        writefln("First capture = %s", captures[1]);
        writefln("2nd capture   = %s", captures[2]);
    }
}
</code></pre><p><code class="prettyprint">ctRegex</code> instead of <code class="prettyprint">regex</code> builds the regular expression at compile-time, trading off compile-time speed for runtime speed.
</p>
<pre class="prettyprint"><code>auto re = ctRegex!(`My name is (\w+)\. I work for ([A-Za-z ]+)\.`); // automaton built at compile-time
</code></pre><p>See: <a href="http://dlang.org/phobos/std_regex.html">http://dlang.org/phobos/std_regex.html</a>
</p>
</div><a name="Patching-a-library-available-on-the-DUB-registry"></a><div class="idiom"><a class="permalink" href="#Patching-a-library-available-on-the-DUB-registry">Link
</a><h1 id="patching-a-library-available-on-the-dub-registry">Patching a library available on the DUB registry</h1>
<p>How to patch a <a href="http://code.dlang.org/">DUB</a> library with minimal hassle for users?
</p>
<ol>
<li>Commit your hopefully working fix.
</li>
<li>Test it. <code class="prettyprint">dub add-local</code> or <code class="prettyprint">dub test</code> can help to do it.
</li>
<li>Make a git tag. <strong>Please try to respect</strong> <a href="http://semver.org/">SemVer</a> with respect to breaking changes, else you could break an unknown number of already released software. Also don't name your tag <code class="prettyprint">1.0.0</code> instead of <code class="prettyprint">v1.0.0</code>, else the registry won't take it. Likewise avoid leading zeroes like <code class="prettyprint">v2.3.04</code>.
</li>
<li>Push the changes online. I would advise <code class="prettyprint">git push</code> then <code class="prettyprint">git push --tags</code> but to be honest I don't really know why it's better in this order. At this point the fix is online. This is not finished yet!
</li>
<li>Login on <a href="http://code.dlang.org">http://code.dlang.org</a> and click on <code class="prettyprint">Trigger manual update</code> button. This will acknowledge the new version and allow downstream to update to the new tag as soon as possible. <strong>Do not skip this step if you want a timely fix.</strong> If you don't do the manual update, the new tag will be acknowledged by the registry in less than 30 minutes. 
</li>
<li>If downstream doesn't actually download the latest tag, consider using <code class="prettyprint">dub clean-caches</code> to update the list of available packages.
</li>
<li>Your users are now delighted. Enjoy the endorphin rush.
</li>
</ol>
</div><a name="Adding-or-removing-an-element-from-arrays"></a><div class="idiom"><a class="permalink" href="#Adding-or-removing-an-element-from-arrays">Link
</a><h1 id="adding-or-removing-an-element-from-arrays">Adding or removing an element from arrays</h1>
<p>Appending an element to a dynamic array:
</p>
<pre class="prettyprint"><code>T[] arr;
arr ~= value;                    // value is pushed at the back of the array
</code></pre><p>Removing an element from a dynamic array given an index:
</p>
<pre class="prettyprint"><code>import std.algorithm : remove;
T[] arr;
arr = arr.remove(index);         // index-th element is removed from array
</code></pre><p>Removing an element from a dynamic array given a value:
</p>
<pre class="prettyprint"><code>auto removeElement(R, N)(R haystack, N needle)
{
    import std.algorithm : countUntil, remove;
    auto index = haystack.countUntil(needle);
    return (index != -1) ? haystack.remove(index) : haystack;
}
int[] arr = [1, 5, 10];
arr = arr.removeElement(5);
assert(arr == [1,10]);
</code></pre><p>Adding an element into an associative array:
</p>
<pre class="prettyprint"><code>aa[key] = value;                 // aa[key] is created if not already existing
</code></pre><p>Removing an element from an associative array given a key:
</p>
<pre class="prettyprint"><code>aa.remove(key);                  // there is a builtin property to do that
</code></pre></div><a name="Skip-initialization-with-=-void"></a><div class="idiom"><a class="permalink" href="#Skip-initialization-with-=-void">Link
</a><h1 id="skip-initialization-with-void">Skip initialization with <code class="prettyprint">= void</code></h1>
<p>In D, everything is initialized by default.<br/>Because it may have a runtime cost, the syntax <code class="prettyprint">= void</code> allows to skip default assignment for stack variables.
</p>
<pre class="prettyprint"><code>void bark()
{
    int dog = void; // dog contains garbage
    if(cond)
        dog = 1;
    else
        dog = 2;
}
</code></pre><p><code class="prettyprint">= void</code> is also accepted for <code class="prettyprint">struct</code> or <code class="prettyprint">class</code> members but doesn't do anything useful at the moment. Don't use it there.
</p>
</div><a name="if-(__ctfe)"></a><div class="idiom"><a class="permalink" href="#if-(__ctfe)">Link
</a><h1 id="if-ctfe"><code class="prettyprint">if (__ctfe)</code></h1>
<p>D will run a lot of things through Compile-Time Function Execution (CTFE) if you ask for it.<br/>Sometimes it is useful to branch based on whether the function is executing at compile-time or runtime.
</p>
<p>That's what <code class="prettyprint">__ctfe</code> is for.
</p>
<pre class="prettyprint"><code>import std.stdio;

string AmIInCTFE()
{
    if (__ctfe)
        return "Hello from CTFE!";
    else
        return "Hello from runtime!";
}

void main(string[] args)
{
    writefln(AmIInCTFE());
    pragma(msg, AmIInCTFE());
}
</code></pre></div><a name="Grouping-modules-with-package.d"></a><div class="idiom"><a class="permalink" href="#Grouping-modules-with-package.d">Link
</a><h1 id="grouping-modules-with-package-d">Grouping modules with package.d</h1>
<p><code class="prettyprint">package.d</code> is a special filename which is used in import resolution. When reading:
</p>
<pre class="prettyprint"><code>import mymodule;
</code></pre><p>a D compiler will search for either <code class="prettyprint">mymodule.d</code> or <code class="prettyprint">mymodule/package.d</code> (and if both exist, it will complain about the name conflict).
</p>
<p>This feature allows to organize modules logically and combined with <code class="prettyprint">public import</code> to split big modules in several parts.
</p>
<p>Here is an example:
</p>
<pre class="prettyprint"><code>// In file path/mypackage/package.d
module mypackage;
public import mypackage.foo;
public import mypackage.bar;
</code></pre><pre class="prettyprint"><code>// In file path/mypackage/foo.d
module mypackage.foo;
</code></pre><pre class="prettyprint"><code>// In file path/mypackage/bar.d
module mypackage.bar;
</code></pre><pre class="prettyprint"><code>// In user code
// mypackage.foo and mypackage.bar are also imported
import mypackage;
</code></pre></div><a name="Should-I-use-++pre-increment-or-post-increment++&#x3F;"></a><div class="idiom"><a class="permalink" href="#Should-I-use-++pre-increment-or-post-increment++&#x3F;">Link
</a><h1 id="should-i-use-pre-increment-or-post-increment">Should I use ++pre-increment or post-increment++?</h1>
<p>Either one. It did matter a bit in C++ but doesn't in D. The compiler rewrites internally post-increments to pre-increments if the expression result is unused.
</p>
<pre class="prettyprint"><code>  it++; // lowered to ++it since the result isn't used
  it--; // ditto, lowered to --it
</code></pre><p>Contrarily to <a href="http://en.cppreference.com/w/cpp/language/operator_incdec">C++</a>, a single operator overload is used to define both pre-increment and post-increment in user-defined types.
</p>
<pre class="prettyprint"><code>struct WrappedInt
{
    int m;

    // overload both ++pre and post++
    int opUnary(string op)() if (op == "++")
    {
        return ++m;
    }
}
</code></pre></div><a name="&#x2F;+-+&#x2F;-nestable-comments-and-version(none)"></a><div class="idiom"><a class="permalink" href="#&#x2F;+-+&#x2F;-nestable-comments-and-version(none)">Link
</a><h1 id="nestable-comments-and-version-none"><code class="prettyprint">/+ +/</code> nestable comments and <code class="prettyprint">version(none)</code></h1>
<p>In addition to single-line comments <code class="prettyprint">//</code> and block comments <code class="prettyprint">/* */</code>, D supports nestable block comments with <code class="prettyprint">/+ +/</code>.
</p>
<pre class="prettyprint"><code>/+
    This whole block is commented.

    /**
     * A documented function.
     */
    void doStuff()
    {
        // blah blah
    }

    /+
      Such block comments are nestable.
    +/
+/

</code></pre><p>They are handy when commenting large swaths of code. It would be the D equivalent to <code class="prettyprint">#if 0</code> / <code class="prettyprint">#endif</code> pairs in C or C++.
</p>
<p>If you prefer the commented portion of code to stay valid, prefer using <code class="prettyprint">version(none)</code>.
</p>
<pre class="prettyprint"><code>version(none)
{
    // This whole block is commented, but still must parse.

    /**
     * A documented function
     */
    void doStuff()
    {
        // blah blah
    }
}

</code></pre><p>Indeed, <code class="prettyprint">none</code> is a special version identifier that cannot be set.
</p>
<pre class="prettyprint"><code>version = none; // Error: version identifier 'none' is reserved and cannot be set
</code></pre></div><a name="Unrecoverable-vs-recoverable-errors"></a><div class="idiom"><a class="permalink" href="#Unrecoverable-vs-recoverable-errors">Link
</a><h1 id="unrecoverable-vs-recoverable-errors">Unrecoverable vs recoverable errors</h1>
<p><em>This item is language-agnostic and perhaps the most widely applicable tip on this page.</em>
</p>
<h2 id="simply-said"> Simply said</h2>
<p>Being a D programmer requires knowing the <strong>two fundamental types of errors</strong> in programs.
</p>
<p>Similarly to many languages with exceptions, errors are separated in <strong>logic errors</strong> and <strong>runtime errors</strong>. This is embodied in the two-headed exception hierarchy:
</p>
<ul>
<li>the <code class="prettyprint">Error</code> class is for <em>logic errors</em> also known as <em>unrecoverable errors</em> also known as&hellip; <em>bugs</em>
</li>
<li>the <code class="prettyprint">Exception</code> class is for <em>runtime errors</em> also known as <em>recoverable errors</em> also known as <em>input errors</em>. But it can also be used for hard-to-classify errors.
</li>
</ul>
<h2 id="unrecoverable-logic-errors"> Unrecoverable/logic errors</h2>
<p>Such errors are basically <strong>bugs</strong>. Logic errors includes but are not limited to:
</p>
<ul>
<li>divide by zero
</li>
<li>out-of-bounds access
</li>
<li>null dereferences
</li>
<li>invalid floating point operations like <code class="prettyprint">log(-1)</code> or <code class="prettyprint">arccos(2)</code>
</li>
<li>out of memory
</li>
<li>failed contract
</li>
</ul>
<p>The recommended way to deal with these is to throw an <code class="prettyprint">Error</code>, for example by using <code class="prettyprint">assert</code>. Indeed <strong>the only reasonable option when encountering a logic error is to crash.</strong> This is how highly reliable system are built: let the OS handle the program crash, let a supervisor restart the faulty process.
</p>
<p>If you think you should recover from bugs and keep things running anyway, <strong>you are dangerous</strong>.
</p>
<h2 id="recoverable-input-errors"> Recoverable/input errors</h2>
<p>Such errors are basically <strong>not bugs</strong>:
</p>
<ul>
<li>all kinds of errors with invalid input
</li>
<li>all kinds of I/O failure (eg: failure to read a file)
</li>
<li>failed API calls
</li>
</ul>
<p>The canonical way to deal with these is to throw an <code class="prettyprint">Exception</code>, for example by using <a href="#Phobos-gems"><code class="prettyprint">enforce</code></a>.
</p>
<p>Some errors are difficult to classify: what is unrecoverable for a program part might well be recoverable for another. In this case it is recommended to use <code class="prettyprint">Exception</code>.
</p>
<h2 id="more-material"> More material</h2>
<p>Walter Bright repeatedly explained this item in the D newsgroup:
</p>
<p><em>I believe this is a misunderstanding of what exceptions are for. "File not found" exceptions, and other errors detected in inputs, are routine and routinely recoverable.</em>
</p>
<p><em>This discussion has come up repeatedly in the last 30 years. It's root is always the same - conflating handling of input errors, and handling of bugs in the logic of the program.</em>
</p>
<p><em>The two are COMPLETELY different and dealing with them follow completely different philosophies, goals, and strategies.</em>
</p>
<p><em>Input errors are not bugs, and vice versa. There is no overlap.</em>
</p>
<p>See also: <a href="http://forum.dlang.org/post/m07gf1$18jl$1@digitalmars.com">http://forum.dlang.org/post/m07gf1$18jl$1@digitalmars.com</a>
</p>
</div><a name="Recursive-Sum-Type-with-matching"></a><div class="idiom"><a class="permalink" href="#Recursive-Sum-Type-with-matching">Link
</a><h1 id="recursive-sum-type-with-matching">Recursive Sum Type with matching</h1>
<p>Never write a tagged union by hand again! <code class="prettyprint">std.variant.Algebraic</code> solves this nicely.
</p>
<p><strong>Recursive data-types are supported</strong> despite the documentation saying it's not.
</p>
<pre class="prettyprint"><code>import std.variant, std.typecons;
alias Symbol = Typedef!string;

// an Atom is either:
// - a string,
// - a double,
// - a bool,
// - a Symbol,
// - or Atom[]
alias Atom = Algebraic!(string, double, bool, Symbol, This[]); // Use 'This' for recursive ADT

Atom atom;
if (bool* b = atom.peek!bool()) // is atom a bool?
{
    // here *b is a bool
}

</code></pre><p><code class="prettyprint">Algebraic</code> can be used with the <a href="http://dlang.org/phobos/std_variant.html#.visit"><code class="prettyprint">visit</code></a> function to do an exhaustive match.
</p>
<pre class="prettyprint"><code>// an exhaustive match with this ADT
string toString(Atom atom)
{
    return atom.visit!(
        (Symbol sym) =&gt; cast(string)sym,
        (string s) =&gt; s,
        (double x) =&gt; to!string(x),
        (bool b) =&gt; (b ? "#t" : "#f"),
        (Atom[] atoms) =&gt; "(" ~ map!toString(atoms).joiner(" ").array.to!string ~ ")"
    );
}
</code></pre><p>See: <a href="http://dlang.org/phobos/std_variant.html#.Algebraic">http://dlang.org/phobos/std_variant.html#.Algebraic</a>
</p>
</div><a name="Ensure-array-access-without-bounds-checking"></a><div class="idiom"><a class="permalink" href="#Ensure-array-access-without-bounds-checking">Link
</a><h1 id="ensure-array-access-without-bounds-checking">Ensure array access without bounds checking</h1>
<p>Slice indexing will check bounds depending on <code class="prettyprint">-boundscheck</code> and <code class="prettyprint">@safe</code>.
</p>
<p>But pointer indexing won't ever check bounds.
</p>
<pre class="prettyprint"><code>int[] myArray;
myArray.ptr[index] = 4; // no bounds check, guaranteed
</code></pre></div><a name="Implicit-conversion-for-user-defined-types"></a><div class="idiom"><a class="permalink" href="#Implicit-conversion-for-user-defined-types">Link
</a><h1 id="implicit-conversion-for-user-defined-types">Implicit conversion for user-defined types</h1>
<p>D officially forbid implicit conversions for user-defined types to avoid the pitfalls associated with them.<br/>But defining an implicit conversion is actually possible by abusing <code class="prettyprint">alias this</code>.
</p>
<pre class="prettyprint"><code>import std.stdio;

struct NumberAsString
{
    private string value;
    this(string value)
    {
        this.value = value;
    }

    int convHelper()
    {
        return to!int(value);
    }
    alias convHelper this;
}

void main(string[] args)
{
    auto a = NumberAsString("123");
    int b = a; // implicit conversion happening here
    writefln("%d", b);
}

</code></pre><p>This idiom was discovered by <a href="http://3d.benjamin-thaut.de/?p=90">Benjamin Thaut</a>.
</p>
</div><a name="if-embedded-declaration"></a><div class="idiom"><a class="permalink" href="#if-embedded-declaration">Link
</a><h1 id="if-embedded-declaration"><code class="prettyprint">if</code> embedded declaration</h1>
<p>It's legal to declare a variable inside an <code class="prettyprint">if</code> condition.
</p>
<pre class="prettyprint"><code>// AA lookup shortcut
if (auto found = key in AA)
{
    // found only defined in this scope
    doStuff(*found);
}
</code></pre><p>The branch is taken if the right expression evaluates to a truthy value.
</p>
<pre class="prettyprint"><code>// Equivalent for Java's instanceof
if (auto derived = cast(Derived)obj)
{
    // derived only defined in this scope
    doStuff(derived);
}
</code></pre></div><a name="Linking-with-C-gotchas"></a><div class="idiom"><a class="permalink" href="#Linking-with-C-gotchas">Link
</a><h1 id="linking-with-c-gotchas">Linking with C gotchas</h1>
<h2 id="the-little-known-pragma-mangle"> The little known <code class="prettyprint">pragma(mangle)</code></h2>
<p><code class="prettyprint">pragma(mangle)</code> is extremely useful when you need to statically link with a C function whose name is a reserved D keyword:
</p>
<pre class="prettyprint"><code>pragma(mangle, "version") extern(C) void c_version();
</code></pre></div><a name="Placement-new-with-emplace"></a><div class="idiom"><a class="permalink" href="#Placement-new-with-emplace">Link
</a><h1 id="placement-new-with-emplace">Placement new with <code class="prettyprint">emplace</code></h1>
<p>C++ has <a href="http://www.drdobbs.com/cpp/calling-constructors-with-placement-new/232901023">"placement new"</a> which is a language construct to construct an object at a given pointer location.
</p>
<p>The D equivalent is a Phobos function called <code class="prettyprint">std.conv.emplace</code> (documentation <a href="http://dlang.org/phobos/std_conv.html#.emplace">here</a>).
</p>
<p><code class="prettyprint">emplace</code> can be used as an alternative to <code class="prettyprint">new</code> to support custom allocation. For example this perform construction of a class instance on the stack.
</p>
<pre class="prettyprint"><code>import std.conv : emplace;
ubyte[__traits(classInstanceSize, YourClass)] buffer;
YourClass obj = emplace!YourClass(buffer[], ctor args...);
// Destroy the object explicitly at scope exit, which will
// call the destructor deterministically.
scope(exit) .destroy(obj);
</code></pre><p>Courtesy of <a href="http://arsdnet.net/">Adam D. Ruppe</a>.
</p>
</div><a name="The-truth-about-shared"></a><div class="idiom"><a class="permalink" href="#The-truth-about-shared">Link
</a><h1 id="the-truth-about-shared">The truth about shared</h1>
<p>It's unclear when and how <code class="prettyprint">shared</code> will be implemented.
</p>
<p>Virtually noone use <code class="prettyprint">shared</code> currently. You are better off ignoring it at this moment.
</p>
</div><a name="Searching-for-a-substring-position"></a><div class="idiom"><a class="permalink" href="#Searching-for-a-substring-position">Link
</a><h1 id="searching-for-a-substring-position">Searching for a substring position</h1>
<p>The <code class="prettyprint">indexOf</code> function in <code class="prettyprint">std.string</code> gives back the index of the first found substring or -1 if missing.
</p>
<pre class="prettyprint"><code>import std.string;
assert(indexOf("Hello home sweet home", "home") == 6);
</code></pre><p>See: <a href="http://dlang.org/phobos/std_string.html#.indexOf">http://dlang.org/phobos/std_string.html#.indexOf</a>
</p>
</div><a name="Inheriting-from-Exception"></a><div class="idiom"><a class="permalink" href="#Inheriting-from-Exception">Link
</a><h1 id="inheriting-from-exception">Inheriting from Exception</h1>
<p>When in doubt, do it like Phobos!
</p>
<pre class="prettyprint"><code>class MyOwnException : Exception
{
    public
    {
        @safe pure nothrow this(string message,
                                string file =__FILE__,
                                size_t line = __LINE__,
                                Throwable next = null)
        {
            super(message, file, line, next);
        }
    }
}
</code></pre></div></div><footer><h2>Why d-idioms?
</h2><p>D is often praised for its unbounded power. But power needs availability.<br><br> You may hear about every feature a language has to offer, for example after going through the reference book.<br><br>That does not mean you'll feel comfortable using these features, or figure out how they fit together.<br><br>When I discovered D in 2007, I thought its learning curve was gentle. I already knew a subset of it and the language was simpler back then. It all felt glorious and familiar.<br><br>The truth took years to unfold. I had skipped the learning phase because of this perceived familiarity. But D is a language of its own that needs dedicated learning like any other. I had to expand my "subset of confidence", feature by feature.<br><br>This unexpected difficulty is aggravated by the fact information is scattered in different places (wiki, language documentation, D specification, D forums...).Sometimes valuable information can be hard to come by. It doesn't help that some of the resources implicitely assume that your time has little value.<br><br>d-idioms is for: library talk, language explanations, and useful or devious code snippets.<br><br>This website is for the busy developer who doesn't have the time to learn languages in depth.<br><br> <strong>d-idioms expands the subset of D you feel comfortable with, quickly. This is a pragmatic page, about a pragmatic language, for pragmatic programmers.</strong><br><br>
</p><h2>About
</h2><p>Hi, I'm Guillaume Piolat, I make professional audio plug-ins with D at <a href="https://www.auburnsounds.com">Auburn Sounds</a>. <br> I hope this site is as useful for you to read, as it was for me to write!
</p><h2>Other contributors:
</h2><ul id="contributors"><li><a href="https://github.com/BBasile">Basile Burg
</a></li><li><a href="https://github.com/bubnenkoff">Dmitry Bubnenkov
</a></li><li><a href="https://github.com/yannick">Yannick Koechlin
</a></li><li><a href="https://github.com/veelo">Bastiaan Veelo
</a></li></ul></footer></body></html>